<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hu Zheng">
<meta name="dcterms.date" content="2024-10-01">

<title>SPIDER-seq - 6&nbsp; Figure6</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Figure7.html" rel="next">
<link href="./Figure5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Figure1.html">Main Figure</a></li><li class="breadcrumb-item"><a href="./Figure6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Figure6</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SPIDER-seq</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SPIDER-seq</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Main Figure</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Figure1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Figure2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Figure3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Figure4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Figure5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Figure6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Figure7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Figure7</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Supplemental Figure</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">FigureS1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">FigureS2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">FigureS3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">FigureS4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FigureS5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">FigureS6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">FigureS7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">FigureS8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">FigureS9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">FigureS10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FigureS11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">FigureS11</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#figure6_a" id="toc-figure6_a" class="nav-link active" data-scroll-target="#figure6_a"><span class="header-section-number">6.1</span> Figure6_A</a></li>
  <li><a href="#figure6_b" id="toc-figure6_b" class="nav-link" data-scroll-target="#figure6_b"><span class="header-section-number">6.2</span> Figure6_B</a></li>
  <li><a href="#figure6_c" id="toc-figure6_c" class="nav-link" data-scroll-target="#figure6_c"><span class="header-section-number">6.3</span> Figure6_C</a></li>
  <li><a href="#figure6_d" id="toc-figure6_d" class="nav-link" data-scroll-target="#figure6_d"><span class="header-section-number">6.4</span> Figure6_D</a></li>
  <li><a href="#figure6_e" id="toc-figure6_e" class="nav-link" data-scroll-target="#figure6_e"><span class="header-section-number">6.5</span> Figure6_E</a></li>
  <li><a href="#figure6_f" id="toc-figure6_f" class="nav-link" data-scroll-target="#figure6_f"><span class="header-section-number">6.6</span> Figure6_F</a></li>
  <li><a href="#figure6_g" id="toc-figure6_g" class="nav-link" data-scroll-target="#figure6_g"><span class="header-section-number">6.7</span> Figure6_G</a></li>
  <li><a href="#figure6_h" id="toc-figure6_h" class="nav-link" data-scroll-target="#figure6_h"><span class="header-section-number">6.8</span> Figure6_H</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Figure1.html">Main Figure</a></li><li class="breadcrumb-item"><a href="./Figure6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Figure6</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Figure6</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hu Zheng </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-10-01</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdWGCNA)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(enrichR)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GeneOverlap)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(umap)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scCustomize)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpointdensity)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Biorplot)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'bin/Palettes.R'</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#source('bin/includes.R')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>all.Adult <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../data/rds/all.Adult.rds'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Adult.Ex <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../data/rds/Adult.Ex.rds'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#sp.PFC &lt;- readRDS('../data/rds/sp.PFC.rds')</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#PFC.MERFISH &lt;- readRDS('../data/rds/PFC.MERFISH.rds')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Adult.Ex.barcode <span class="ot">&lt;-</span> <span class="fu">subset</span>(Adult.Ex, <span class="at">cells=</span><span class="fu">colnames</span>(Adult.Ex)[<span class="fu">which</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  )])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>Adult.IT.PT.barcode <span class="ot">&lt;-</span> <span class="fu">subset</span>(Adult.Ex, <span class="at">cells=</span><span class="fu">colnames</span>(Adult.Ex)[<span class="fu">which</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  (Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>Ex_subtype <span class="sc">==</span> <span class="st">"IT"</span>) <span class="sc">|</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  (Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>Ex_subtype <span class="sc">==</span> <span class="st">"PT"</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"Adult1"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  )])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gene_lib <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../data/csv/transmitter_and_receptor/gene_lib.csv'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_to_title</span>(gene_lib<span class="sc">$</span>Axon_Guidance))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>CAMs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_to_title</span>(gene_lib<span class="sc">$</span>CAM))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(AGMs, CAMs))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> all_gene[<span class="fu">which</span>(all_gene <span class="sc">%in%</span> <span class="fu">rownames</span>(seu))]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># gene expression filter</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>all_gene_exp <span class="ot">&lt;-</span> <span class="fu">AverageExpression</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  seu, <span class="at">features=</span>all_gene, <span class="at">assays=</span><span class="st">"RNA"</span>, <span class="at">slot=</span><span class="st">"data"</span>, <span class="at">group.by=</span><span class="st">"Proj_subtype"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>RNA</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>all_gene_exp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">log1p</span>(all_gene_exp))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>all_gene_exp<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">apply</span>(all_gene_exp, <span class="dv">1</span>, max)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># gene cell percentage filter</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(seu<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>data[all_gene,])))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>all_gene_pct<span class="sc">$</span>Proj_subtype <span class="ot">&lt;-</span> <span class="fu">as.character</span>(seu<span class="sc">$</span>Proj_subtype)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  all_gene_pct <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Proj_subtype) <span class="sc">|&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_gene), <span class="cf">function</span>(x){</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">which</span>(x<span class="sc">&gt;</span><span class="dv">0</span>))<span class="sc">/</span><span class="fu">length</span>(x)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(all_gene_pct) <span class="ot">&lt;-</span> all_gene_pct<span class="sc">$</span>Proj_cluster</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(all_gene_pct[,<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_gene_pct) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">33</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>all_gene_pct<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">apply</span>(all_gene_pct, <span class="dv">1</span>, max)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> all_gene[<span class="fu">which</span>(all_gene_exp<span class="sc">$</span>max<span class="sc">&gt;</span><span class="fl">0.1</span> <span class="sc">&amp;</span> all_gene_pct<span class="sc">$</span>max<span class="sc">&gt;</span><span class="fl">0.1</span>)]</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> AGMs[<span class="fu">which</span>(AGMs <span class="sc">%in%</span> all_gene)]</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>CAMs <span class="ot">&lt;-</span> CAMs[<span class="fu">which</span>(CAMs <span class="sc">%in%</span> all_gene)]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> AGMs[<span class="fu">which</span>(<span class="sc">!</span>(AGMs <span class="sc">%in%</span> CAMs))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seu) <span class="ot">&lt;-</span> <span class="st">"Proj_module"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>DEGs <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu, <span class="at">features=</span>all_gene, <span class="at">logfc.threshold =</span> <span class="fl">0.25</span>, <span class="at">min.pct =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster ITi-D</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster PTi</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster ITi-V</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster ITc</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(DEGs<span class="sc">$</span>gene)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="figure6_a" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="figure6_a"><span class="header-section-number">6.1</span> Figure6_A</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gene_order</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>PTi_gene <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sema3e"</span>,<span class="st">"Sema3c"</span>,<span class="st">"Spon1"</span>,<span class="st">"Sdk2"</span>,<span class="st">"Cntfr"</span>,<span class="st">"Cntn1"</span>,<span class="st">"Ntng1"</span>,<span class="st">"Cdh6"</span>,<span class="st">"Emb"</span>,<span class="st">"Cdh20"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ctnna2"</span>,<span class="st">"Flrt1"</span>,<span class="st">"Fam19a1"</span>,<span class="st">"Rgma"</span>,<span class="st">"Igfbp4"</span>,<span class="st">"Ephb1"</span>,<span class="st">"Disp2"</span>,<span class="st">"Celsr2"</span>,<span class="st">"Sema6d"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tpbg"</span>,<span class="st">"Dscaml1"</span>,<span class="st">"Kirrel3"</span>,<span class="st">"Wnt5a"</span>,<span class="st">"Fgfr1"</span>,<span class="st">"Cntnap5b"</span>,<span class="st">"Cntnap2"</span>,<span class="st">"Cdh22"</span>,<span class="st">"Nrp1"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nrxn3"</span>,<span class="st">"Ntrk3"</span>,<span class="st">"Nrcam"</span>,<span class="st">"Opcml"</span>,<span class="st">"Clstn3"</span>,<span class="st">"Cntn2"</span>,<span class="st">"Cntnap1"</span>,<span class="st">"Ephb3"</span>,<span class="st">"Lrrn1"</span>,<span class="st">"Epha7"</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>ITi_D_gene <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Robo2"</span>,<span class="st">"Clstn1"</span>,<span class="st">"Lrrc8b"</span>,<span class="st">"Camk2g"</span>,<span class="st">"Ntm"</span>,<span class="st">"Tspan5"</span>,<span class="st">"Dkk3"</span>,<span class="st">"Cadm4"</span>,<span class="st">"Pcdh7"</span>,<span class="st">"Sema7a"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cadm2"</span>,<span class="st">"Cbln2"</span>,<span class="st">"Frzb"</span>,<span class="st">"Tyro3"</span>,<span class="st">"Rtn4"</span>,<span class="st">"Ppp3ca"</span>,<span class="st">"Cdh12"</span>,<span class="st">"Fstl4"</span>,<span class="st">"Nptx2"</span>,<span class="st">"Lingo1"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pcdh9"</span>,<span class="st">"Unc5d"</span>,<span class="st">"Il1rap"</span>,<span class="st">"Rtn4r"</span>,<span class="st">"Nptx1"</span>,<span class="st">"Plxna4"</span>,<span class="st">"Cdh9"</span>,<span class="st">"Bmp3"</span>,<span class="st">"Crtac1"</span>,<span class="st">"Nrp2"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ptprt"</span>,<span class="st">"Jund"</span>,<span class="st">"Ubb"</span>,<span class="st">"Camk1"</span>,<span class="st">"Lrrc4c"</span>,<span class="st">"Pcdh15"</span>,<span class="st">"Matn2"</span>,<span class="st">"Il1rapl1"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>ITi_V_gene <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Edil3"</span>,<span class="st">"Epha4"</span>,<span class="st">"Cadm3"</span>,<span class="st">"Col25a1"</span>,<span class="st">"Ptprk"</span>,<span class="st">"Islr2"</span>,<span class="st">"Lrp8"</span>,<span class="st">"Il1rapl2"</span>,<span class="st">"Cdh10"</span>,<span class="st">"Nbl1"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lrrc4"</span>,<span class="st">"Ptprd"</span>,<span class="st">"Coch"</span>,<span class="st">"Plxnd1"</span>,<span class="st">"Ptgfrn"</span>,<span class="st">"Dkkl1"</span>,<span class="st">"Fat3"</span>,<span class="st">"Vstm2a"</span>,<span class="st">"Efnb2"</span>,<span class="st">"Cdh2"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ncam2"</span>,<span class="st">"Lsamp"</span>,<span class="st">"Pcdh10"</span>,<span class="st">"Sema3d"</span>,<span class="st">"Rspo2"</span>,<span class="st">"Jun"</span>,<span class="st">"Smoc2"</span>,<span class="st">"Car4"</span>,<span class="st">"Sdc3"</span>,<span class="st">"C1ql3"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Plxnc1"</span>,<span class="st">"Cdh13"</span>,<span class="st">"Efnb3"</span>,<span class="st">"Nov"</span>,<span class="st">"Cadm1"</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>gene_order <span class="ot">&lt;-</span> <span class="fu">c</span>(PTi_gene,ITi_D_gene,ITi_V_gene)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># annotation_col</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>ITi_D <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"14"</span>,<span class="st">"17"</span>,<span class="st">"22"</span>,<span class="st">"23"</span>,<span class="st">"25"</span>,<span class="st">"26"</span>,<span class="st">"27"</span>,<span class="st">"28"</span>,<span class="st">"29"</span>,<span class="st">"31"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>ITi_V <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"7"</span>,<span class="st">"8"</span>,<span class="st">"9"</span>,<span class="st">"10"</span>,<span class="st">"15"</span>,<span class="st">"16"</span>,<span class="st">"18"</span>,<span class="st">"19"</span>,<span class="st">"20"</span>,<span class="st">"21"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>ITc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"11"</span>,<span class="st">"12"</span>,<span class="st">"13"</span>,<span class="st">"24"</span>,<span class="st">"30"</span>,<span class="st">"32"</span>,<span class="st">"33"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>PTi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"4"</span>,<span class="st">"5"</span>,<span class="st">"6"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>Proj_subtype_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">c</span>(PTi,ITi_D,ITi_V))</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>avg_exp <span class="ot">&lt;-</span> <span class="fu">AverageExpression</span>(seu, <span class="at">features =</span> gene_order, <span class="at">group.by =</span> <span class="st">'Proj_subtype'</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">assays =</span> <span class="st">"RNA"</span>, <span class="at">slot =</span> <span class="st">"data"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>avg_exp <span class="ot">&lt;-</span> avg_exp<span class="sc">$</span>RNA</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>avg_exp_zscore <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">scale</span>(<span class="fu">t</span>(avg_exp)))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>annotation_col <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gene_module =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"module1"</span>,<span class="st">"module2"</span>,<span class="st">"module3"</span>),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="fu">length</span>(PTi_gene),<span class="fu">length</span>(ITi_D_gene),<span class="fu">length</span>(ITi_V_gene))),</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> gene_order</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>annotation_col<span class="sc">$</span>Gene_type <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>annotation_col<span class="sc">$</span>Gene_type[<span class="fu">which</span>(<span class="fu">rownames</span>(annotation_col) <span class="sc">%in%</span> AGMs)] <span class="ot">&lt;-</span> <span class="st">"AGMs"</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>annotation_col<span class="sc">$</span>Gene_type[<span class="fu">which</span>(<span class="fu">rownames</span>(annotation_col) <span class="sc">%in%</span> CAMs)] <span class="ot">&lt;-</span> <span class="st">"CAMs"</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># annotation_row</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>annotation_row <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Projection_module =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"PTi"</span>, <span class="st">"ITi-D"</span>, <span class="st">"ITi-V"</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">11</span>, <span class="dv">10</span>)),</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PTi"</span>, <span class="st">"ITi-D"</span>, <span class="st">"ITi-V"</span>)),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> Proj_subtype_order</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="co"># ann_color</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>ann_colors <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">Projection_module =</span> <span class="fu">c</span>(<span class="st">'PTi'</span><span class="ot">=</span><span class="st">'#d62728'</span>,<span class="st">'ITi-D'</span><span class="ot">=</span><span class="st">'#1f77b4'</span>,<span class="st">'ITi-V'</span><span class="ot">=</span><span class="st">'#ff7f0e'</span>),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gene_type =</span> <span class="fu">c</span>(<span class="st">"AGMs"</span><span class="ot">=</span><span class="st">"#8ebbda"</span>,<span class="st">"CAMs"</span><span class="ot">=</span><span class="st">"#e99496"</span>),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gene_module =</span> <span class="fu">c</span>(<span class="st">'module1'</span><span class="ot">=</span><span class="st">"#ff6666"</span>,<span class="st">'module2'</span><span class="ot">=</span><span class="st">"#6666ff"</span>,<span class="st">'module3'</span><span class="ot">=</span><span class="st">'#FDAE6BFF'</span>)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co">#dist = dist(t(avg_exp_zscore[Proj_subtype_order,gene_order]))</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co">#hclust &lt;- hclust(dist)</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co">#dend = reorder(as.dendrogram(hclust), wts=1:length(gene_order))</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="co">#col_cluster &lt;- as.hclust(dend)</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co">#col_cluster$order &lt;- 1:length(gene_order)</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.01</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>Figure6_A <span class="ot">&lt;-</span> </span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(avg_exp_zscore[Proj_subtype_order, gene_order],</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> F, <span class="at">cluster_cols =</span> F, <span class="at">border_color =</span> <span class="st">"grey60"</span>,</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">breaks =</span> breaks,</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"navy"</span>, <span class="st">"white"</span>,<span class="st">"firebrick3"</span>))(<span class="fu">length</span>(breaks)),</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_row =</span> annotation_row, <span class="at">annotation_col =</span> annotation_col,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_colors =</span> ann_colors,</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">gaps_col =</span> <span class="fu">c</span>(<span class="dv">38</span>,<span class="dv">76</span>),</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">gaps_row =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">14</span>,<span class="dv">24</span>),</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_col =</span> <span class="dv">6</span>, <span class="at">show_colnames =</span> F,</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_names_row=</span>F,<span class="at">annotation_names_col=</span>F</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_A.pdf"</span>, <span class="at">plot =</span> Figure6_A,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_b" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="figure6_b"><span class="header-section-number">6.2</span> Figure6_B</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seu) <span class="ot">&lt;-</span> <span class="st">"Proj_module"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>DEGs <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu, <span class="at">features=</span>all_gene, <span class="at">logfc.threshold =</span> <span class="dv">0</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#DEGs$p_val_adj[which(DEGs$p_val_adj==0)] &lt;- 1e-290</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs <span class="ot">&lt;-</span> DEGs[<span class="fu">which</span>(DEGs<span class="sc">$</span>avg_log2FC<span class="sc">&gt;</span><span class="dv">0</span>),]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type[<span class="fu">which</span>(all_gene_DEGs<span class="sc">$</span>gene <span class="sc">%in%</span> AGMs)] <span class="ot">&lt;-</span> <span class="st">"AGMs"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type[<span class="fu">which</span>(all_gene_DEGs<span class="sc">$</span>gene <span class="sc">%in%</span> CAMs)] <span class="ot">&lt;-</span> <span class="st">"CAMs"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>proj_module <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PTi"</span>,<span class="st">"ITi-D"</span>,<span class="st">"ITi-V"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  DEGs_module <span class="ot">&lt;-</span> all_gene_DEGs[all_gene_DEGs<span class="sc">$</span>cluster <span class="sc">==</span> proj_module[i],]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  top10_gene <span class="ot">&lt;-</span> DEGs_module<span class="sc">$</span>gene[<span class="fu">order</span>(DEGs_module<span class="sc">$</span>p_val_adj)][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  DEGs_module<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  DEGs_module<span class="sc">$</span>label[<span class="fu">match</span>(top10_gene, DEGs_module<span class="sc">$</span>gene)] <span class="ot">&lt;-</span> top10_gene</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    x_max <span class="ot">&lt;-</span> <span class="fl">2.2</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    x_max <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  plist[[i]] <span class="ot">&lt;-</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(DEGs_module, <span class="fu">aes</span>(<span class="at">x=</span>avg_log2FC, <span class="at">y=</span> <span class="sc">-</span><span class="fu">log10</span>(p_val_adj))) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span>gene_type), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span> , <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_vline(aes(xintercept=0), colour="black", linetype="dashed", </span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#           linewidth = 0.5) +</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>label, <span class="at">color=</span>gene_type), <span class="at">size=</span><span class="dv">5</span>, <span class="at">max.overlaps=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"AGMs"</span><span class="ot">=</span><span class="st">"#8ebbda"</span>,<span class="st">"CAMs"</span><span class="ot">=</span><span class="st">"#e99496"</span>)) <span class="sc">+</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"AGMs"</span><span class="ot">=</span><span class="st">"#8ebbda"</span>,<span class="st">"CAMs"</span><span class="ot">=</span><span class="st">"#e99496"</span>)) <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">#xlim(0, x_max) +</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fu">max</span>(<span class="sc">-</span><span class="fu">log10</span>(DEGs_module<span class="sc">$</span>p_val_adj))) <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,x_max)) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> proj_module[i], <span class="at">x =</span> <span class="st">'log2FC'</span>, <span class="at">y =</span> <span class="st">'-log10(P value)'</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>Figure6_B <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plist, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>Figure6_B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_B.pdf"</span>, <span class="at">plot =</span> Figure6_B,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_c" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="figure6_c"><span class="header-section-number">6.3</span> Figure6_C</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Barcode <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'VIS-I'</span>,<span class="st">'SSp-I'</span>,<span class="st">'CP-I'</span>,<span class="st">'AUD-I'</span>,<span class="st">'RSP-I'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">'BLA-I'</span>,<span class="st">'ACB-I'</span>,<span class="st">'ENTl-I'</span>,<span class="st">'AId-I'</span>,<span class="st">'ECT-I'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'ACB-C'</span>,<span class="st">'PL-C'</span>,<span class="st">'ECT-C'</span>,<span class="st">'ENTl-C'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'BLA-C'</span>,<span class="st">'CP-C'</span>,<span class="st">'AId-C'</span>,<span class="st">'RSP-C'</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'MD-I'</span>,<span class="st">'RE-I'</span>,<span class="st">'DR-I'</span>,<span class="st">'VTA-I'</span>,<span class="st">'LHA-I'</span>,<span class="st">'SC-I'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> Adult.Ex.barcode<span class="sc">@</span>meta.data[,Barcode]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat[<span class="fu">is.na</span>(Ex_BC_mat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> <span class="fu">scale</span>(Ex_BC_mat)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> Ex_BC_mat[Adult.Ex.barcode<span class="sc">$</span>BC_num <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#set.seed(20230321)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20240422</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>umap_out <span class="ot">&lt;-</span> <span class="fu">umap</span>(Ex_BC_mat)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>umap_result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(umap_out<span class="sc">$</span>layout)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(umap_result) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"UMAP_1"</span>,<span class="st">"UMAP_2"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> <span class="fu">subset</span>(Adult.Ex.barcode, <span class="at">cells =</span> <span class="fu">rownames</span>(umap_result))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings[,<span class="st">"UMAP_1"</span>] <span class="ot">&lt;-</span> umap_result<span class="sc">$</span>UMAP_1</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings[,<span class="st">"UMAP_2"</span>] <span class="ot">&lt;-</span> umap_result<span class="sc">$</span>UMAP_2</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>gene <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Igfbp4"</span>,<span class="st">"Pcdh7"</span>,<span class="st">"Cdh13"</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>plist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  plist[[i]] <span class="ot">&lt;-</span> <span class="fu">Plot_Density_Custom</span>(<span class="at">seurat_object =</span> seu, <span class="at">features =</span> gene[i],</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">viridis_palette =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>()</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>Figure6_C <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plist, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>Figure6_C</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_C.pdf"</span>, <span class="at">plot =</span> Figure6_C,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_d" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="figure6_d"><span class="header-section-number">6.4</span> Figure6_D</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gene <span class="ot">&lt;-</span> <span class="fu">c</span>(PTi_gene, ITi_D_gene, ITi_V_gene)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>gene_BC_mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seu<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>data[gene,])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>gene_BC_mat<span class="sc">$</span>Gene_module <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'module 1'</span>,<span class="st">'module 2'</span>,<span class="st">'module 3'</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="fu">length</span>(PTi_gene), <span class="fu">length</span>(ITi_D_gene),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">length</span>(ITi_V_gene)))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>gene_BC_mat <span class="ot">&lt;-</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  gene_BC_mat <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gene_module) <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(seu), mean)) <span class="sc">|&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(gene_BC_mat) <span class="ot">&lt;-</span> gene_BC_mat<span class="sc">$</span>Gene_module</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>gene_BC_mat <span class="ot">&lt;-</span> <span class="fu">t</span>(gene_BC_mat[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(gene_BC_mat)])</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>gene_BC_mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  gene_BC_mat,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  seu<span class="sc">@</span>meta.data[,<span class="fu">c</span>(<span class="st">'PTi_score'</span>,<span class="st">'ITi_D_score'</span>,<span class="st">'ITi_V_score'</span>)]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gene_BC_mat)[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PTi'</span>, <span class="st">'ITi-D'</span>, <span class="st">'ITi-V'</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>Gene_module <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'module 1'</span>,<span class="st">'module 2'</span>,<span class="st">'module 3'</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>Proj_module <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'PTi'</span>, <span class="st">'ITi-D'</span>, <span class="st">'ITi-V'</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Proj_module &lt;- c('ITi-D', 'ITi-V', 'PTi')</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Proj_module &lt;- c('ITi-V', 'PTi', 'ITi-D')</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>plist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">&lt;-</span> gene_BC_mat[,<span class="fu">c</span>(Gene_module[i],<span class="st">'PTi'</span>, <span class="st">'ITi-D'</span>, <span class="st">'ITi-V'</span>)]</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">&lt;-</span> df_i[df_i[,<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  df_i[,<span class="st">'exp_order'</span>] <span class="ot">&lt;-</span> <span class="fu">rank</span>(df_i[,<span class="dv">1</span>])</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  df_i[,<span class="st">'bin'</span>] <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    df_i[,<span class="st">'exp_order'</span>],</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(df_i[,<span class="st">'exp_order'</span>]), <span class="at">length.out=</span><span class="dv">11</span>),</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">&lt;-</span> </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    df_i <span class="sc">|&gt;</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(bin) <span class="sc">|&gt;</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  df_i_norm <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df_i[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df_i)],<span class="dv">2</span>,<span class="cf">function</span>(x){</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    (x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x))</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  df_i_norm<span class="sc">$</span>x <span class="ot">&lt;-</span> df_i<span class="sc">$</span>bin[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  df_i_norm <span class="ot">&lt;-</span> </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    df_i_norm <span class="sc">|&gt;</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span>x, <span class="at">names_to =</span> <span class="st">'Target'</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  df_i_norm<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_i_norm<span class="sc">$</span>x)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  df_i_norm<span class="sc">$</span>Target <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    df_i_norm<span class="sc">$</span>Target, </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'PTi'</span>,<span class="st">'ITi-D'</span>,<span class="st">'ITi-V'</span>)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  df_i_norm <span class="ot">&lt;-</span> df_i_norm[<span class="fu">which</span>(df_i_norm<span class="sc">$</span>Target<span class="sc">==</span>Proj_module[i]),]</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(df_i_norm<span class="sc">$</span>x, df_i_norm<span class="sc">$</span>Value, <span class="st">"two.sided"</span>, <span class="st">"pearson"</span>)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> <span class="fu">round</span>(cor<span class="sc">$</span>estimate,<span class="dv">2</span>)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> <span class="fu">format</span>(cor<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  plist[[i]] <span class="ot">&lt;-</span> </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(df_i_norm, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>Value, <span class="at">color=</span>Target)) <span class="sc">+</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Target),<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span> , <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span><span class="fl">0.95</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'R ='</span>,R,<span class="st">'</span><span class="sc">\n</span><span class="st">P ='</span>,P,<span class="at">sep=</span><span class="st">' '</span>), <span class="at">hjust=</span><span class="dv">0</span>,</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10%"</span>,<span class="st">"50%"</span>,<span class="st">"100%"</span>)) <span class="sc">+</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> col_Proj_module) <span class="sc">+</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> col_Proj_module) <span class="sc">+</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">paste</span>(Gene_module[i],<span class="st">"expression"</span>), </span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="fu">paste</span>(Proj_module[i],<span class="st">"projection strength"</span>), </span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">title=</span><span class="fu">paste</span>(Gene_module[i])) <span class="sc">+</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>Figure6_D <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plist, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>Figure6_D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_D.pdf"</span>, <span class="at">plot =</span> Figure6_D,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_e" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="figure6_e"><span class="header-section-number">6.5</span> Figure6_E</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/csv/CAMs_AGMs/CAMs_AGMs.hdwgcna.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20240703</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">GetModules</span>(seu.hdwgcna.AGMs_CAMs)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">levels</span>(modules<span class="sc">$</span>module)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> mods[mods <span class="sc">!=</span> <span class="st">'grey'</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>Figure6_E <span class="ot">&lt;-</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">HubGeneNetworkPlot</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  seu.hdwgcna.AGMs_CAMs,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_hubs =</span> <span class="dv">10</span>, <span class="at">n_other=</span><span class="dv">100</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">edge_prop =</span> <span class="fl">0.8</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">edge.alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mods =</span> mods,  </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_graph=</span><span class="cn">FALSE</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "turquoise" "grey90"    "yellow"    "green"     "blue"      "brown"    </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="figure6_f" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="figure6_f"><span class="header-section-number">6.6</span> Figure6_F</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Barcode_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MD-I"</span>,<span class="st">"RE-I"</span>,<span class="st">"DR-I"</span>,<span class="st">"VTA-I"</span>,<span class="st">"LHA-I"</span>,<span class="st">"SC-I"</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"VIS-I"</span>,<span class="st">"SSp-I"</span>,<span class="st">"CP-I"</span>,<span class="st">"AUD-I"</span>,<span class="st">"RSP-I"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BLA-I"</span>,<span class="st">"ACB-I"</span>,<span class="st">"ENTl-I"</span>,<span class="st">"AId-I"</span>,<span class="st">"ECT-I"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"ACB-C"</span>,<span class="st">"PL-C"</span>,<span class="st">"ECT-C"</span>,<span class="st">"ENTl-C"</span>,<span class="st">"BLA-C"</span>,<span class="st">"CP-C"</span>,<span class="st">"AId-C"</span>,<span class="st">"RSP-C"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> all.Adult<span class="sc">@</span>meta.data[<span class="fu">colnames</span>(seu.hdwgcna.AGMs_CAMs), Barcode_order]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> <span class="fu">log1p</span>(<span class="dv">10000</span><span class="sc">*</span>Ex_BC_mat<span class="sc">/</span>seu.hdwgcna.AGMs_CAMs<span class="sc">$</span>nCount_RNA)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># module ME</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>m_obj <span class="ot">&lt;-</span> <span class="fu">GetMetacellObject</span>(seu.hdwgcna.AGMs_CAMs)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>MEs <span class="ot">&lt;-</span> <span class="fu">GetMEs</span>(seu.hdwgcna.AGMs_CAMs, <span class="at">harmonized=</span><span class="cn">FALSE</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>MEs <span class="ot">&lt;-</span> MEs[,<span class="sc">-</span><span class="fu">grep</span>(<span class="st">'grey'</span>,<span class="fu">colnames</span>(MEs))]</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># metacell module ME</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>meta_MEs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(m_obj<span class="sc">@</span>meta.data), <span class="at">ncol =</span> <span class="fu">ncol</span>(MEs))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_MEs) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(m_obj<span class="sc">@</span>meta.data)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_MEs) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(MEs)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># metacell Barcode</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>meta_BCs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(m_obj<span class="sc">@</span>meta.data), <span class="at">ncol =</span> <span class="fu">length</span>(Barcode_order))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_BCs) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(m_obj<span class="sc">@</span>meta.data)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_BCs) <span class="ot">&lt;-</span> Barcode_order</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(meta_MEs)){</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  meta_MEs[i,] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(MEs[<span class="fu">strsplit</span>(m_obj<span class="sc">$</span>cells_merged[[i]], <span class="st">','</span>)[[<span class="dv">1</span>]],], <span class="at">na.rm =</span> T)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  meta_BCs[i,] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Ex_BC_mat[<span class="fu">strsplit</span>(m_obj<span class="sc">$</span>cells_merged[[i]], <span class="st">','</span>)[[<span class="dv">1</span>]],], <span class="at">na.rm =</span> T)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>meta_BCs[<span class="fu">is.nan</span>(meta_BCs)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># coorelation between module ME and Barcode</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>meta_R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="fu">length</span>(Barcode_order))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_R) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"M1"</span>,<span class="st">"M2"</span>,<span class="st">"M3"</span>,<span class="st">"M4"</span>,<span class="st">"M5"</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_R) <span class="ot">&lt;-</span> Barcode_order</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>meta_P <span class="ot">&lt;-</span> meta_R</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>){</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    cor <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(meta_MEs[,<span class="fu">rownames</span>(meta_R)[i]], meta_BCs[,<span class="fu">colnames</span>(meta_R)[j]],</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"two.sided"</span>, <span class="st">"pearson"</span>)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    meta_R[i,j] <span class="ot">&lt;-</span> <span class="fu">round</span>(cor<span class="sc">$</span>estimate,<span class="dv">2</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    meta_P[i,j] <span class="ot">&lt;-</span> <span class="fu">format</span>(cor<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>meta_R <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(meta_R)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>meta_R<span class="sc">$</span>Module <span class="ot">&lt;-</span> <span class="fu">rownames</span>(meta_R)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>df_meta_R <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(meta_R, <span class="sc">!</span>Module, <span class="at">names_to =</span> <span class="st">"Target"</span>, <span class="at">values_to =</span> <span class="st">"R"</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>meta_P <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(meta_P)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>meta_P<span class="sc">$</span>Module <span class="ot">&lt;-</span> <span class="fu">rownames</span>(meta_P)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>df_meta_P <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(meta_P, <span class="sc">!</span>Module, <span class="at">names_to =</span> <span class="st">"Target"</span>, <span class="at">values_to =</span> <span class="st">"Pvalue"</span>)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Module"</span> <span class="ot">=</span> df_meta_R<span class="sc">$</span>Module,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Target"</span> <span class="ot">=</span> df_meta_R<span class="sc">$</span>Target,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(df_meta_R<span class="sc">$</span>R),</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pvalue"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(df_meta_P<span class="sc">$</span>Pvalue)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Log_Pvalue <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log10</span>(df<span class="sc">$</span>Pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Barcode <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VIS-I"</span>,<span class="st">"SSp-I"</span>,<span class="st">"CP-I"</span>,<span class="st">"AUD-I"</span>,<span class="st">"RSP-I"</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"BLA-I"</span>,<span class="st">"ACB-I"</span>,<span class="st">"ENTl-I"</span>,<span class="st">"AId-I"</span>,<span class="st">"ECT-I"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"ACB-C"</span>,<span class="st">"PL-C"</span>,<span class="st">"ECT-C"</span>,<span class="st">"ENTl-C"</span>,<span class="st">"BLA-C"</span>,<span class="st">"CP-C"</span>,<span class="st">"AId-C"</span>,<span class="st">"RSP-C"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"MD-I"</span>,<span class="st">"RE-I"</span>,<span class="st">"DR-I"</span>,<span class="st">"VTA-I"</span>,<span class="st">"LHA-I"</span>,<span class="st">"SC-I"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Target <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Target, <span class="at">levels =</span> Barcode)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Module <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Module, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"M1"</span>,<span class="st">"M2"</span>,<span class="st">"M3"</span>,<span class="st">"M4"</span>,<span class="st">"M5"</span>)))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>label[<span class="fu">which</span>(df<span class="sc">$</span>R<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> df<span class="sc">$</span>Pvalue <span class="sc">&lt;</span> <span class="fl">0.05</span>)] <span class="ot">&lt;-</span> <span class="st">"*"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>label[<span class="fu">which</span>(df<span class="sc">$</span>R<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> df<span class="sc">$</span>Pvalue <span class="sc">&lt;</span> <span class="fl">0.01</span>)] <span class="ot">&lt;-</span> <span class="st">"**"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>label[<span class="fu">which</span>(df<span class="sc">$</span>R<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> df<span class="sc">$</span>Pvalue <span class="sc">&lt;</span> <span class="fl">0.001</span>)] <span class="ot">&lt;-</span> <span class="st">"***"</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.01</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>R[<span class="fu">which</span>(df<span class="sc">$</span>R <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>R[<span class="fu">which</span>(df<span class="sc">$</span>R <span class="sc">&gt;</span> <span class="fl">0.5</span>)] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>Figure6_F <span class="ot">&lt;-</span> </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>Target, <span class="at">y=</span>Module, <span class="at">fill=</span>R)) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"gray"</span>, <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>label),<span class="at">col =</span><span class="st">"black"</span>,<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_vline(xintercept = c(1.5:23.5), size=1, color="lightgray") +</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">colours =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"navy"</span>,<span class="st">"white"</span>,<span class="st">"firebrick3"</span>))(<span class="dv">100</span>), <span class="at">na.value=</span><span class="st">"firebrick3"</span>) <span class="sc">+</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">15</span>), </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>Figure6_F</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_F.pdf"</span>, <span class="at">plot =</span> Figure6_F,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_g" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="figure6_g"><span class="header-section-number">6.7</span> Figure6_G</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> seu.hdwgcna.AGMs_CAMs</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M2 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M2</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M4 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M4</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">which</span>(seu<span class="sc">$</span>Ex_subtype<span class="sc">==</span><span class="st">"IT"</span>),]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>UMAP_1 <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> df<span class="sc">$</span>UMAP_2 <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">3</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Figure6_G_1 <span class="ot">&lt;-</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(df, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">color=</span><span class="st">"lightgray"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointdensity</span>(df[<span class="fu">which</span>(df<span class="sc">$</span>M4<span class="sc">&gt;</span><span class="dv">0</span>),], <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightgray"</span>,<span class="st">"white"</span>,<span class="st">"blue"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"blue"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                        ) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"M4"</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>))</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>Figure6_G_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_1.pdf"</span>, <span class="at">plot =</span> Figure6_G_1,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Figure6_G_2 <span class="ot">&lt;-</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(df, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">color=</span><span class="st">"lightgray"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointdensity</span>(df[<span class="fu">which</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span><span class="sc">&gt;</span><span class="dv">0</span>),], <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightgray"</span>,<span class="st">"white"</span>,<span class="st">"red"</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"red"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                        ) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"CP-C"</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>Figure6_G_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_2.pdf"</span>, <span class="at">plot =</span> Figure6_G_2,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_cor <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span><span class="sc">&gt;</span><span class="dv">0</span>),]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_cor[,<span class="st">'exp_order'</span>] <span class="ot">&lt;-</span> <span class="fu">rank</span>(df_cor<span class="sc">$</span>M4)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>df_cor[,<span class="st">'bin'</span>] <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  df_cor[,<span class="st">'exp_order'</span>],</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(df_cor[,<span class="st">'exp_order'</span>]), <span class="at">length.out=</span><span class="dv">11</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>df_cor <span class="ot">&lt;-</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  df_cor <span class="sc">|&gt;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(bin) <span class="sc">|&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>df_cor_norm <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df_cor[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df_cor)],<span class="dv">2</span>,<span class="cf">function</span>(x){</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    (x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>df_cor_norm<span class="sc">$</span>x <span class="ot">&lt;-</span> df_cor<span class="sc">$</span>bin[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(df_cor_norm<span class="sc">$</span>M4, df_cor_norm<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>, <span class="st">"two.sided"</span>, <span class="st">"pearson"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">round</span>(cor<span class="sc">$</span>estimate,<span class="dv">2</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">format</span>(cor<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>Figure6_G_3 <span class="ot">&lt;-</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_cor_norm, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">fill=</span><span class="st">"blue"</span>,<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span> , <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span><span class="fl">0.95</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'R ='</span>,R,<span class="st">'</span><span class="sc">\n</span><span class="st">P ='</span>,P,<span class="at">sep=</span><span class="st">' '</span>), <span class="at">hjust=</span><span class="dv">0</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10%"</span>,<span class="st">"50%"</span>,<span class="st">"100%"</span>)) <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_color_manual(values = col_Proj_module) +</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_fill_manual(values = col_Proj_module) +</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">paste</span>(<span class="st">"M4 Eigengenes"</span>), </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="fu">paste</span>(<span class="st">"CP-C projection strength"</span>), </span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">title=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>Figure6_G_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_3.pdf"</span>, <span class="at">plot =</span> Figure6_G_3,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="figure6_h" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="figure6_h"><span class="header-section-number">6.8</span> Figure6_H</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> seu.hdwgcna.AGMs_CAMs</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M2 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M2</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M4 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M4</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">which</span>(seu<span class="sc">$</span>Ex_subtype<span class="sc">==</span><span class="st">"IT"</span>),]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>UMAP_1 <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> df<span class="sc">$</span>UMAP_2 <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">3</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Figure6_H_1 <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(df, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">color=</span><span class="st">"lightgray"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointdensity</span>(df[<span class="fu">which</span>(df<span class="sc">$</span>M2<span class="sc">&gt;</span><span class="dv">0</span>),], <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightgray"</span>,<span class="st">"white"</span>,<span class="st">"yellow"</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"yellow"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                        ) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"M2"</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>))</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>Figure6_H_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_1.pdf"</span>, <span class="at">plot =</span> Figure6_H_1,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Figure6_H_2 <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(df, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">color=</span><span class="st">"lightgray"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointdensity</span>(df[<span class="fu">which</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span><span class="sc">&gt;</span><span class="dv">0</span>),], <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> UMAP_1, <span class="at">y =</span> UMAP_2), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightgray"</span>,<span class="st">"white"</span>,<span class="st">"red"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"red"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                        ) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AId-I"</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>Figure6_H_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_2.pdf"</span>, <span class="at">plot =</span> Figure6_H_2,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_cor <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span><span class="sc">&gt;</span><span class="dv">0</span>),]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_cor[,<span class="st">'exp_order'</span>] <span class="ot">&lt;-</span> <span class="fu">rank</span>(df_cor<span class="sc">$</span>M2)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>df_cor[,<span class="st">'bin'</span>] <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  df_cor[,<span class="st">'exp_order'</span>],</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(df_cor[,<span class="st">'exp_order'</span>]), <span class="at">length.out=</span><span class="dv">11</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>df_cor <span class="ot">&lt;-</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  df_cor <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(bin) <span class="sc">|&gt;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>df_cor_norm <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df_cor[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df_cor)],<span class="dv">2</span>,<span class="cf">function</span>(x){</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    (x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>df_cor_norm<span class="sc">$</span>x <span class="ot">&lt;-</span> df_cor<span class="sc">$</span>bin[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(df_cor_norm<span class="sc">$</span>M2, df_cor_norm<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>, <span class="st">"two.sided"</span>, <span class="st">"pearson"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">round</span>(cor<span class="sc">$</span>estimate,<span class="dv">2</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">format</span>(cor<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>Figure6_H_3 <span class="ot">&lt;-</span> </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_cor_norm, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">"yellow"</span>) <span class="sc">+</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">fill=</span><span class="st">"yellow"</span>,<span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span> , <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span><span class="fl">0.95</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">'R ='</span>,R,<span class="st">'</span><span class="sc">\n</span><span class="st">P ='</span>,P,<span class="at">sep=</span><span class="st">' '</span>), <span class="at">hjust=</span><span class="dv">0</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>), </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10%"</span>,<span class="st">"50%"</span>,<span class="st">"100%"</span>)) <span class="sc">+</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_color_manual(values = col_Proj_module) +</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_fill_manual(values = col_Proj_module) +</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">paste</span>(<span class="st">"M2 Eigengenes"</span>), </span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="fu">paste</span>(<span class="st">"AId-I projection strength"</span>), </span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">title=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>Figure6_H_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Figure6_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_3.pdf"</span>, <span class="at">plot =</span> Figure6_H_3,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Figure5.html" class="pagination-link" aria-label="Figure5">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Figure5</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Figure7.html" class="pagination-link" aria-label="Figure7">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Figure7</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb40" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Hu Zheng"</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-10-01"</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="an">date-format:</span><span class="co"> YYYY-MM-DD</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Figure6</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdWGCNA)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(enrichR)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GeneOverlap)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(umap)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scCustomize)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpointdensity)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Biorplot)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'bin/Palettes.R'</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="co">#source('bin/includes.R')</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>all.Adult <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../data/rds/all.Adult.rds'</span>)</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>Adult.Ex <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../data/rds/Adult.Ex.rds'</span>)</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="co">#sp.PFC &lt;- readRDS('../data/rds/sp.PFC.rds')</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="co">#PFC.MERFISH &lt;- readRDS('../data/rds/PFC.MERFISH.rds')</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>Adult.Ex.barcode <span class="ot">&lt;-</span> <span class="fu">subset</span>(Adult.Ex, <span class="at">cells=</span><span class="fu">colnames</span>(Adult.Ex)[<span class="fu">which</span>(</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>  Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>  )])</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>Adult.IT.PT.barcode <span class="ot">&lt;-</span> <span class="fu">subset</span>(Adult.Ex, <span class="at">cells=</span><span class="fu">colnames</span>(Adult.Ex)[<span class="fu">which</span>(</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  (Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>Ex_subtype <span class="sc">==</span> <span class="st">"IT"</span>) <span class="sc">|</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  (Adult.Ex<span class="sc">$</span>BC_num<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>Ex_subtype <span class="sc">==</span> <span class="st">"PT"</span> <span class="sc">&amp;</span> Adult.Ex<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"Adult1"</span>)</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>  )])</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>gene_lib <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../data/csv/transmitter_and_receptor/gene_lib.csv'</span>)</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_to_title</span>(gene_lib<span class="sc">$</span>Axon_Guidance))</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>CAMs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_to_title</span>(gene_lib<span class="sc">$</span>CAM))</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(AGMs, CAMs))</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> all_gene[<span class="fu">which</span>(all_gene <span class="sc">%in%</span> <span class="fu">rownames</span>(seu))]</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a><span class="co"># gene expression filter</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>all_gene_exp <span class="ot">&lt;-</span> <span class="fu">AverageExpression</span>(</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>  seu, <span class="at">features=</span>all_gene, <span class="at">assays=</span><span class="st">"RNA"</span>, <span class="at">slot=</span><span class="st">"data"</span>, <span class="at">group.by=</span><span class="st">"Proj_subtype"</span></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>RNA</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>all_gene_exp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">log1p</span>(all_gene_exp))</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>all_gene_exp<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">apply</span>(all_gene_exp, <span class="dv">1</span>, max)</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a><span class="co"># gene cell percentage filter</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(seu<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>data[all_gene,])))</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>all_gene_pct<span class="sc">$</span>Proj_subtype <span class="ot">&lt;-</span> <span class="fu">as.character</span>(seu<span class="sc">$</span>Proj_subtype)</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> </span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>  all_gene_pct <span class="sc">|&gt;</span></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Proj_subtype) <span class="sc">|&gt;</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_gene), <span class="cf">function</span>(x){</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">which</span>(x<span class="sc">&gt;</span><span class="dv">0</span>))<span class="sc">/</span><span class="fu">length</span>(x)</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(all_gene_pct) <span class="ot">&lt;-</span> all_gene_pct<span class="sc">$</span>Proj_cluster</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>all_gene_pct <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(all_gene_pct[,<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_gene_pct) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">33</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>all_gene_pct<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">apply</span>(all_gene_pct, <span class="dv">1</span>, max)</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> all_gene[<span class="fu">which</span>(all_gene_exp<span class="sc">$</span>max<span class="sc">&gt;</span><span class="fl">0.1</span> <span class="sc">&amp;</span> all_gene_pct<span class="sc">$</span>max<span class="sc">&gt;</span><span class="fl">0.1</span>)]</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> AGMs[<span class="fu">which</span>(AGMs <span class="sc">%in%</span> all_gene)]</span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>CAMs <span class="ot">&lt;-</span> CAMs[<span class="fu">which</span>(CAMs <span class="sc">%in%</span> all_gene)]</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>AGMs <span class="ot">&lt;-</span> AGMs[<span class="fu">which</span>(<span class="sc">!</span>(AGMs <span class="sc">%in%</span> CAMs))]</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seu) <span class="ot">&lt;-</span> <span class="st">"Proj_module"</span></span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>DEGs <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu, <span class="at">features=</span>all_gene, <span class="at">logfc.threshold =</span> <span class="fl">0.25</span>, <span class="at">min.pct =</span> <span class="fl">0.1</span>)</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>all_gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(DEGs<span class="sc">$</span>gene)</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_A</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=10, fig.height=4}</span></span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a><span class="in"># gene_order</span></span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a><span class="in">PTi_gene &lt;- c(</span></span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a><span class="in">  "Sema3e","Sema3c","Spon1","Sdk2","Cntfr","Cntn1","Ntng1","Cdh6","Emb","Cdh20",</span></span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a><span class="in">  "Ctnna2","Flrt1","Fam19a1","Rgma","Igfbp4","Ephb1","Disp2","Celsr2","Sema6d",</span></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a><span class="in">  "Tpbg","Dscaml1","Kirrel3","Wnt5a","Fgfr1","Cntnap5b","Cntnap2","Cdh22","Nrp1",</span></span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a><span class="in">  "Nrxn3","Ntrk3","Nrcam","Opcml","Clstn3","Cntn2","Cntnap1","Ephb3","Lrrn1","Epha7"</span></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a><span class="in">ITi_D_gene &lt;- c(</span></span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a><span class="in">  "Robo2","Clstn1","Lrrc8b","Camk2g","Ntm","Tspan5","Dkk3","Cadm4","Pcdh7","Sema7a",</span></span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a><span class="in">  "Cadm2","Cbln2","Frzb","Tyro3","Rtn4","Ppp3ca","Cdh12","Fstl4","Nptx2","Lingo1",</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a><span class="in">  "Pcdh9","Unc5d","Il1rap","Rtn4r","Nptx1","Plxna4","Cdh9","Bmp3","Crtac1","Nrp2",</span></span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a><span class="in">  "Ptprt","Jund","Ubb","Camk1","Lrrc4c","Pcdh15","Matn2","Il1rapl1"</span></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a><span class="in">ITi_V_gene &lt;- c(</span></span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a><span class="in">  "Edil3","Epha4","Cadm3","Col25a1","Ptprk","Islr2","Lrp8","Il1rapl2","Cdh10","Nbl1",</span></span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a><span class="in">  "Lrrc4","Ptprd","Coch","Plxnd1","Ptgfrn","Dkkl1","Fat3","Vstm2a","Efnb2","Cdh2",</span></span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a><span class="in">  "Ncam2","Lsamp","Pcdh10","Sema3d","Rspo2","Jun","Smoc2","Car4","Sdc3","C1ql3",</span></span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a><span class="in">  "Plxnc1","Cdh13","Efnb3","Nov","Cadm1"</span></span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a><span class="in">gene_order &lt;- c(PTi_gene,ITi_D_gene,ITi_V_gene)</span></span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a><span class="in"># annotation_col</span></span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a><span class="in">ITi_D &lt;- c("1","14","17","22","23","25","26","27","28","29","31")</span></span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a><span class="in">ITi_V &lt;- c("7","8","9","10","15","16","18","19","20","21")</span></span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a><span class="in">ITc &lt;- c("2","3","11","12","13","24","30","32","33")</span></span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a><span class="in">PTi &lt;- c("4","5","6")</span></span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a><span class="in">Proj_subtype_order &lt;- as.character(c(PTi,ITi_D,ITi_V))</span></span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a><span class="in">avg_exp &lt;- AverageExpression(seu, features = gene_order, group.by = 'Proj_subtype',</span></span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a><span class="in">                             assays = "RNA", slot = "data")</span></span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a><span class="in">avg_exp &lt;- avg_exp$RNA</span></span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a><span class="in">avg_exp_zscore &lt;- as.matrix(scale(t(avg_exp)))</span></span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_col = data.frame(</span></span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a><span class="in">  Gene_module = rep(c("module1","module2","module3"),</span></span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a><span class="in">                    c(length(PTi_gene),length(ITi_D_gene),length(ITi_V_gene))),</span></span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = gene_order</span></span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb40-149"><a href="#cb40-149" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_col$Gene_type &lt;- ""</span></span>
<span id="cb40-150"><a href="#cb40-150" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_col$Gene_type[which(rownames(annotation_col) %in% AGMs)] &lt;- "AGMs"</span></span>
<span id="cb40-151"><a href="#cb40-151" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_col$Gene_type[which(rownames(annotation_col) %in% CAMs)] &lt;- "CAMs"</span></span>
<span id="cb40-152"><a href="#cb40-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-153"><a href="#cb40-153" aria-hidden="true" tabindex="-1"></a><span class="in"># annotation_row</span></span>
<span id="cb40-154"><a href="#cb40-154" aria-hidden="true" tabindex="-1"></a><span class="in">annotation_row = data.frame(</span></span>
<span id="cb40-155"><a href="#cb40-155" aria-hidden="true" tabindex="-1"></a><span class="in">  Projection_module = factor(rep(c("PTi", "ITi-D", "ITi-V"), c(3, 11, 10)),</span></span>
<span id="cb40-156"><a href="#cb40-156" aria-hidden="true" tabindex="-1"></a><span class="in">                  levels = c("PTi", "ITi-D", "ITi-V")),</span></span>
<span id="cb40-157"><a href="#cb40-157" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = Proj_subtype_order</span></span>
<span id="cb40-158"><a href="#cb40-158" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb40-159"><a href="#cb40-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-160"><a href="#cb40-160" aria-hidden="true" tabindex="-1"></a><span class="in"># ann_color</span></span>
<span id="cb40-161"><a href="#cb40-161" aria-hidden="true" tabindex="-1"></a><span class="in">ann_colors = list(</span></span>
<span id="cb40-162"><a href="#cb40-162" aria-hidden="true" tabindex="-1"></a><span class="in">  Projection_module = c('PTi'='#d62728','ITi-D'='#1f77b4','ITi-V'='#ff7f0e'),</span></span>
<span id="cb40-163"><a href="#cb40-163" aria-hidden="true" tabindex="-1"></a><span class="in">  Gene_type = c("AGMs"="#8ebbda","CAMs"="#e99496"),</span></span>
<span id="cb40-164"><a href="#cb40-164" aria-hidden="true" tabindex="-1"></a><span class="in">  Gene_module = c('module1'="#ff6666",'module2'="#6666ff",'module3'='#FDAE6BFF')</span></span>
<span id="cb40-165"><a href="#cb40-165" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb40-166"><a href="#cb40-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-167"><a href="#cb40-167" aria-hidden="true" tabindex="-1"></a><span class="in">#dist = dist(t(avg_exp_zscore[Proj_subtype_order,gene_order]))</span></span>
<span id="cb40-168"><a href="#cb40-168" aria-hidden="true" tabindex="-1"></a><span class="in">#hclust &lt;- hclust(dist)</span></span>
<span id="cb40-169"><a href="#cb40-169" aria-hidden="true" tabindex="-1"></a><span class="in">#dend = reorder(as.dendrogram(hclust), wts=1:length(gene_order))</span></span>
<span id="cb40-170"><a href="#cb40-170" aria-hidden="true" tabindex="-1"></a><span class="in">#col_cluster &lt;- as.hclust(dend)</span></span>
<span id="cb40-171"><a href="#cb40-171" aria-hidden="true" tabindex="-1"></a><span class="in">#col_cluster$order &lt;- 1:length(gene_order)</span></span>
<span id="cb40-172"><a href="#cb40-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-173"><a href="#cb40-173" aria-hidden="true" tabindex="-1"></a><span class="in">breaks &lt;- seq(-2,2,0.01)</span></span>
<span id="cb40-174"><a href="#cb40-174" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_A &lt;- </span></span>
<span id="cb40-175"><a href="#cb40-175" aria-hidden="true" tabindex="-1"></a><span class="in">  pheatmap::pheatmap(avg_exp_zscore[Proj_subtype_order, gene_order],</span></span>
<span id="cb40-176"><a href="#cb40-176" aria-hidden="true" tabindex="-1"></a><span class="in">         cluster_rows = F, cluster_cols = F, border_color = "grey60",</span></span>
<span id="cb40-177"><a href="#cb40-177" aria-hidden="true" tabindex="-1"></a><span class="in">         breaks = breaks,</span></span>
<span id="cb40-178"><a href="#cb40-178" aria-hidden="true" tabindex="-1"></a><span class="in">         color = colorRampPalette(c("navy", "white","firebrick3"))(length(breaks)),</span></span>
<span id="cb40-179"><a href="#cb40-179" aria-hidden="true" tabindex="-1"></a><span class="in">         annotation_row = annotation_row, annotation_col = annotation_col,</span></span>
<span id="cb40-180"><a href="#cb40-180" aria-hidden="true" tabindex="-1"></a><span class="in">         annotation_colors = ann_colors,</span></span>
<span id="cb40-181"><a href="#cb40-181" aria-hidden="true" tabindex="-1"></a><span class="in">         gaps_col = c(38,76),</span></span>
<span id="cb40-182"><a href="#cb40-182" aria-hidden="true" tabindex="-1"></a><span class="in">         gaps_row = c(3,14,24),</span></span>
<span id="cb40-183"><a href="#cb40-183" aria-hidden="true" tabindex="-1"></a><span class="in">         fontsize_col = 6, show_colnames = F,</span></span>
<span id="cb40-184"><a href="#cb40-184" aria-hidden="true" tabindex="-1"></a><span class="in">         annotation_names_row=F,annotation_names_col=F</span></span>
<span id="cb40-185"><a href="#cb40-185" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb40-186"><a href="#cb40-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-187"><a href="#cb40-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-188"><a href="#cb40-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-191"><a href="#cb40-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-192"><a href="#cb40-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-193"><a href="#cb40-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-194"><a href="#cb40-194" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_A.pdf"</span>, <span class="at">plot =</span> Figure6_A,</span>
<span id="cb40-195"><a href="#cb40-195" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-196"><a href="#cb40-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-197"><a href="#cb40-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-198"><a href="#cb40-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-199"><a href="#cb40-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-200"><a href="#cb40-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-201"><a href="#cb40-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-202"><a href="#cb40-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_B</span></span>
<span id="cb40-203"><a href="#cb40-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-206"><a href="#cb40-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-207"><a href="#cb40-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb40-208"><a href="#cb40-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb40-209"><a href="#cb40-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-210"><a href="#cb40-210" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> Adult.IT.PT.barcode</span>
<span id="cb40-211"><a href="#cb40-211" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seu) <span class="ot">&lt;-</span> <span class="st">"Proj_module"</span></span>
<span id="cb40-212"><a href="#cb40-212" aria-hidden="true" tabindex="-1"></a>DEGs <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu, <span class="at">features=</span>all_gene, <span class="at">logfc.threshold =</span> <span class="dv">0</span>)</span>
<span id="cb40-213"><a href="#cb40-213" aria-hidden="true" tabindex="-1"></a><span class="co">#DEGs$p_val_adj[which(DEGs$p_val_adj==0)] &lt;- 1e-290</span></span>
<span id="cb40-214"><a href="#cb40-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-215"><a href="#cb40-215" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs <span class="ot">&lt;-</span> DEGs[<span class="fu">which</span>(DEGs<span class="sc">$</span>avg_log2FC<span class="sc">&gt;</span><span class="dv">0</span>),]</span>
<span id="cb40-216"><a href="#cb40-216" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb40-217"><a href="#cb40-217" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type[<span class="fu">which</span>(all_gene_DEGs<span class="sc">$</span>gene <span class="sc">%in%</span> AGMs)] <span class="ot">&lt;-</span> <span class="st">"AGMs"</span></span>
<span id="cb40-218"><a href="#cb40-218" aria-hidden="true" tabindex="-1"></a>all_gene_DEGs<span class="sc">$</span>gene_type[<span class="fu">which</span>(all_gene_DEGs<span class="sc">$</span>gene <span class="sc">%in%</span> CAMs)] <span class="ot">&lt;-</span> <span class="st">"CAMs"</span></span>
<span id="cb40-219"><a href="#cb40-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-220"><a href="#cb40-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-221"><a href="#cb40-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=3}</span></span>
<span id="cb40-222"><a href="#cb40-222" aria-hidden="true" tabindex="-1"></a><span class="in">proj_module &lt;- c("PTi","ITi-D","ITi-V")</span></span>
<span id="cb40-223"><a href="#cb40-223" aria-hidden="true" tabindex="-1"></a><span class="in">plist &lt;- list()</span></span>
<span id="cb40-224"><a href="#cb40-224" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3){</span></span>
<span id="cb40-225"><a href="#cb40-225" aria-hidden="true" tabindex="-1"></a><span class="in">  DEGs_module &lt;- all_gene_DEGs[all_gene_DEGs$cluster == proj_module[i],]</span></span>
<span id="cb40-226"><a href="#cb40-226" aria-hidden="true" tabindex="-1"></a><span class="in">  top10_gene &lt;- DEGs_module$gene[order(DEGs_module$p_val_adj)][1:5]</span></span>
<span id="cb40-227"><a href="#cb40-227" aria-hidden="true" tabindex="-1"></a><span class="in">  DEGs_module$label &lt;- ""</span></span>
<span id="cb40-228"><a href="#cb40-228" aria-hidden="true" tabindex="-1"></a><span class="in">  DEGs_module$label[match(top10_gene, DEGs_module$gene)] &lt;- top10_gene</span></span>
<span id="cb40-229"><a href="#cb40-229" aria-hidden="true" tabindex="-1"></a><span class="in">  if (i==1){</span></span>
<span id="cb40-230"><a href="#cb40-230" aria-hidden="true" tabindex="-1"></a><span class="in">    x_max &lt;- 2.2</span></span>
<span id="cb40-231"><a href="#cb40-231" aria-hidden="true" tabindex="-1"></a><span class="in">  }else{</span></span>
<span id="cb40-232"><a href="#cb40-232" aria-hidden="true" tabindex="-1"></a><span class="in">    x_max &lt;- 1</span></span>
<span id="cb40-233"><a href="#cb40-233" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb40-234"><a href="#cb40-234" aria-hidden="true" tabindex="-1"></a><span class="in">  plist[[i]] &lt;- </span></span>
<span id="cb40-235"><a href="#cb40-235" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(DEGs_module, aes(x=avg_log2FC, y= -log10(p_val_adj))) +</span></span>
<span id="cb40-236"><a href="#cb40-236" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(aes(fill=gene_type), shape=21, color="black" , size=3) +</span></span>
<span id="cb40-237"><a href="#cb40-237" aria-hidden="true" tabindex="-1"></a><span class="in">    #geom_vline(aes(xintercept=0), colour="black", linetype="dashed", </span></span>
<span id="cb40-238"><a href="#cb40-238" aria-hidden="true" tabindex="-1"></a><span class="in">    #           linewidth = 0.5) +</span></span>
<span id="cb40-239"><a href="#cb40-239" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_repel(aes(label=label, color=gene_type), size=5, max.overlaps=100) +</span></span>
<span id="cb40-240"><a href="#cb40-240" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() +</span></span>
<span id="cb40-241"><a href="#cb40-241" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(plot.title = element_text(size = 20, hjust = 0.5),</span></span>
<span id="cb40-242"><a href="#cb40-242" aria-hidden="true" tabindex="-1"></a><span class="in">          text = element_text(size = 15), legend.position = "none") +</span></span>
<span id="cb40-243"><a href="#cb40-243" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = c("AGMs"="#8ebbda","CAMs"="#e99496")) +</span></span>
<span id="cb40-244"><a href="#cb40-244" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_color_manual(values = c("AGMs"="#8ebbda","CAMs"="#e99496")) +</span></span>
<span id="cb40-245"><a href="#cb40-245" aria-hidden="true" tabindex="-1"></a><span class="in">    #xlim(0, x_max) +</span></span>
<span id="cb40-246"><a href="#cb40-246" aria-hidden="true" tabindex="-1"></a><span class="in">    ylim(0,max(-log10(DEGs_module$p_val_adj))) +</span></span>
<span id="cb40-247"><a href="#cb40-247" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(breaks=c(0,0.5,1,1.5,2), limits = c(0,x_max)) +</span></span>
<span id="cb40-248"><a href="#cb40-248" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(title = proj_module[i], x = 'log2FC', y = '-log10(P value)')</span></span>
<span id="cb40-249"><a href="#cb40-249" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb40-250"><a href="#cb40-250" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_B &lt;- plot_grid(plotlist = plist, ncol = 3)</span></span>
<span id="cb40-251"><a href="#cb40-251" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_B</span></span>
<span id="cb40-252"><a href="#cb40-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-253"><a href="#cb40-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-254"><a href="#cb40-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-257"><a href="#cb40-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-258"><a href="#cb40-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-259"><a href="#cb40-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-260"><a href="#cb40-260" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_B.pdf"</span>, <span class="at">plot =</span> Figure6_B,</span>
<span id="cb40-261"><a href="#cb40-261" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-262"><a href="#cb40-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-263"><a href="#cb40-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-264"><a href="#cb40-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-265"><a href="#cb40-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-266"><a href="#cb40-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-267"><a href="#cb40-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-268"><a href="#cb40-268" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_C</span></span>
<span id="cb40-269"><a href="#cb40-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-270"><a href="#cb40-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=3}</span></span>
<span id="cb40-271"><a href="#cb40-271" aria-hidden="true" tabindex="-1"></a><span class="in">Barcode &lt;- c('VIS-I','SSp-I','CP-I','AUD-I','RSP-I',</span></span>
<span id="cb40-272"><a href="#cb40-272" aria-hidden="true" tabindex="-1"></a><span class="in">             'BLA-I','ACB-I','ENTl-I','AId-I','ECT-I',</span></span>
<span id="cb40-273"><a href="#cb40-273" aria-hidden="true" tabindex="-1"></a><span class="in">             'ACB-C','PL-C','ECT-C','ENTl-C',</span></span>
<span id="cb40-274"><a href="#cb40-274" aria-hidden="true" tabindex="-1"></a><span class="in">             'BLA-C','CP-C','AId-C','RSP-C',</span></span>
<span id="cb40-275"><a href="#cb40-275" aria-hidden="true" tabindex="-1"></a><span class="in">             'MD-I','RE-I','DR-I','VTA-I','LHA-I','SC-I')</span></span>
<span id="cb40-276"><a href="#cb40-276" aria-hidden="true" tabindex="-1"></a><span class="in">Ex_BC_mat &lt;- Adult.Ex.barcode@meta.data[,Barcode]</span></span>
<span id="cb40-277"><a href="#cb40-277" aria-hidden="true" tabindex="-1"></a><span class="in">Ex_BC_mat[is.na(Ex_BC_mat)] &lt;- 0</span></span>
<span id="cb40-278"><a href="#cb40-278" aria-hidden="true" tabindex="-1"></a><span class="in">Ex_BC_mat &lt;- scale(Ex_BC_mat)</span></span>
<span id="cb40-279"><a href="#cb40-279" aria-hidden="true" tabindex="-1"></a><span class="in">Ex_BC_mat &lt;- Ex_BC_mat[Adult.Ex.barcode$BC_num &gt; 1,]</span></span>
<span id="cb40-280"><a href="#cb40-280" aria-hidden="true" tabindex="-1"></a><span class="in">#set.seed(20230321)</span></span>
<span id="cb40-281"><a href="#cb40-281" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(20240422)</span></span>
<span id="cb40-282"><a href="#cb40-282" aria-hidden="true" tabindex="-1"></a><span class="in">umap_out &lt;- umap(Ex_BC_mat)</span></span>
<span id="cb40-283"><a href="#cb40-283" aria-hidden="true" tabindex="-1"></a><span class="in">umap_result &lt;- as.data.frame(umap_out$layout)</span></span>
<span id="cb40-284"><a href="#cb40-284" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(umap_result) = c("UMAP_1","UMAP_2")</span></span>
<span id="cb40-285"><a href="#cb40-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-286"><a href="#cb40-286" aria-hidden="true" tabindex="-1"></a><span class="in">seu &lt;- subset(Adult.Ex.barcode, cells = rownames(umap_result))</span></span>
<span id="cb40-287"><a href="#cb40-287" aria-hidden="true" tabindex="-1"></a><span class="in">seu@reductions$umap@cell.embeddings[,"UMAP_1"] &lt;- umap_result$UMAP_1</span></span>
<span id="cb40-288"><a href="#cb40-288" aria-hidden="true" tabindex="-1"></a><span class="in">seu@reductions$umap@cell.embeddings[,"UMAP_2"] &lt;- umap_result$UMAP_2</span></span>
<span id="cb40-289"><a href="#cb40-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-290"><a href="#cb40-290" aria-hidden="true" tabindex="-1"></a><span class="in">gene &lt;- c("Igfbp4","Pcdh7","Cdh13")</span></span>
<span id="cb40-291"><a href="#cb40-291" aria-hidden="true" tabindex="-1"></a><span class="in">plist &lt;- list()</span></span>
<span id="cb40-292"><a href="#cb40-292" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3){</span></span>
<span id="cb40-293"><a href="#cb40-293" aria-hidden="true" tabindex="-1"></a><span class="in">  plist[[i]] &lt;- Plot_Density_Custom(seurat_object = seu, features = gene[i],</span></span>
<span id="cb40-294"><a href="#cb40-294" aria-hidden="true" tabindex="-1"></a><span class="in">                    viridis_palette = "magma") +</span></span>
<span id="cb40-295"><a href="#cb40-295" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void() +</span></span>
<span id="cb40-296"><a href="#cb40-296" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(plot.title = element_text(hjust = 0.5, size = 25)) +</span></span>
<span id="cb40-297"><a href="#cb40-297" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_fixed()</span></span>
<span id="cb40-298"><a href="#cb40-298" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb40-299"><a href="#cb40-299" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_C &lt;- plot_grid(plotlist = plist, nrow = 1)</span></span>
<span id="cb40-300"><a href="#cb40-300" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_C</span></span>
<span id="cb40-301"><a href="#cb40-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-302"><a href="#cb40-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-303"><a href="#cb40-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-306"><a href="#cb40-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-307"><a href="#cb40-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-308"><a href="#cb40-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-309"><a href="#cb40-309" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_C.pdf"</span>, <span class="at">plot =</span> Figure6_C,</span>
<span id="cb40-310"><a href="#cb40-310" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-311"><a href="#cb40-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-312"><a href="#cb40-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-313"><a href="#cb40-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-314"><a href="#cb40-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-315"><a href="#cb40-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-316"><a href="#cb40-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-317"><a href="#cb40-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_D</span></span>
<span id="cb40-318"><a href="#cb40-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-319"><a href="#cb40-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=3}</span></span>
<span id="cb40-320"><a href="#cb40-320" aria-hidden="true" tabindex="-1"></a><span class="in">gene &lt;- c(PTi_gene, ITi_D_gene, ITi_V_gene)</span></span>
<span id="cb40-321"><a href="#cb40-321" aria-hidden="true" tabindex="-1"></a><span class="in">gene_BC_mat &lt;- as.data.frame(seu@assays$RNA@data[gene,])</span></span>
<span id="cb40-322"><a href="#cb40-322" aria-hidden="true" tabindex="-1"></a><span class="in">gene_BC_mat$Gene_module &lt;- rep(c('module 1','module 2','module 3'),</span></span>
<span id="cb40-323"><a href="#cb40-323" aria-hidden="true" tabindex="-1"></a><span class="in">                               c(length(PTi_gene), length(ITi_D_gene),</span></span>
<span id="cb40-324"><a href="#cb40-324" aria-hidden="true" tabindex="-1"></a><span class="in">                                 length(ITi_V_gene)))</span></span>
<span id="cb40-325"><a href="#cb40-325" aria-hidden="true" tabindex="-1"></a><span class="in">gene_BC_mat &lt;- </span></span>
<span id="cb40-326"><a href="#cb40-326" aria-hidden="true" tabindex="-1"></a><span class="in">  gene_BC_mat |&gt;</span></span>
<span id="cb40-327"><a href="#cb40-327" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Gene_module) |&gt;</span></span>
<span id="cb40-328"><a href="#cb40-328" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::summarize(across(1:ncol(seu), mean)) |&gt;</span></span>
<span id="cb40-329"><a href="#cb40-329" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame()</span></span>
<span id="cb40-330"><a href="#cb40-330" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(gene_BC_mat) &lt;- gene_BC_mat$Gene_module</span></span>
<span id="cb40-331"><a href="#cb40-331" aria-hidden="true" tabindex="-1"></a><span class="in">gene_BC_mat &lt;- t(gene_BC_mat[,2:ncol(gene_BC_mat)])</span></span>
<span id="cb40-332"><a href="#cb40-332" aria-hidden="true" tabindex="-1"></a><span class="in">gene_BC_mat &lt;- cbind(</span></span>
<span id="cb40-333"><a href="#cb40-333" aria-hidden="true" tabindex="-1"></a><span class="in">  gene_BC_mat,</span></span>
<span id="cb40-334"><a href="#cb40-334" aria-hidden="true" tabindex="-1"></a><span class="in">  seu@meta.data[,c('PTi_score','ITi_D_score','ITi_V_score')]</span></span>
<span id="cb40-335"><a href="#cb40-335" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb40-336"><a href="#cb40-336" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(gene_BC_mat)[4:6] &lt;- c('PTi', 'ITi-D', 'ITi-V')</span></span>
<span id="cb40-337"><a href="#cb40-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-338"><a href="#cb40-338" aria-hidden="true" tabindex="-1"></a><span class="in">Gene_module &lt;- c('module 1','module 2','module 3')</span></span>
<span id="cb40-339"><a href="#cb40-339" aria-hidden="true" tabindex="-1"></a><span class="in">Proj_module &lt;- c('PTi', 'ITi-D', 'ITi-V')</span></span>
<span id="cb40-340"><a href="#cb40-340" aria-hidden="true" tabindex="-1"></a><span class="in">#Proj_module &lt;- c('ITi-D', 'ITi-V', 'PTi')</span></span>
<span id="cb40-341"><a href="#cb40-341" aria-hidden="true" tabindex="-1"></a><span class="in">#Proj_module &lt;- c('ITi-V', 'PTi', 'ITi-D')</span></span>
<span id="cb40-342"><a href="#cb40-342" aria-hidden="true" tabindex="-1"></a><span class="in">plist &lt;- list()</span></span>
<span id="cb40-343"><a href="#cb40-343" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3){</span></span>
<span id="cb40-344"><a href="#cb40-344" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i &lt;- gene_BC_mat[,c(Gene_module[i],'PTi', 'ITi-D', 'ITi-V')]</span></span>
<span id="cb40-345"><a href="#cb40-345" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i &lt;- df_i[df_i[,1]&gt;0,]</span></span>
<span id="cb40-346"><a href="#cb40-346" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i[,'exp_order'] &lt;- rank(df_i[,1])</span></span>
<span id="cb40-347"><a href="#cb40-347" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i[,'bin'] &lt;- cut(</span></span>
<span id="cb40-348"><a href="#cb40-348" aria-hidden="true" tabindex="-1"></a><span class="in">    df_i[,'exp_order'],</span></span>
<span id="cb40-349"><a href="#cb40-349" aria-hidden="true" tabindex="-1"></a><span class="in">    seq(1, max(df_i[,'exp_order']), length.out=11),</span></span>
<span id="cb40-350"><a href="#cb40-350" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = c(1:10))</span></span>
<span id="cb40-351"><a href="#cb40-351" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i &lt;- </span></span>
<span id="cb40-352"><a href="#cb40-352" aria-hidden="true" tabindex="-1"></a><span class="in">    df_i |&gt;</span></span>
<span id="cb40-353"><a href="#cb40-353" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(bin) |&gt;</span></span>
<span id="cb40-354"><a href="#cb40-354" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::summarize(across(2:4, ~ mean(.x, na.rm = TRUE)))</span></span>
<span id="cb40-355"><a href="#cb40-355" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm &lt;- as.data.frame(apply(df_i[1:10,2:ncol(df_i)],2,function(x){</span></span>
<span id="cb40-356"><a href="#cb40-356" aria-hidden="true" tabindex="-1"></a><span class="in">    (x-min(x))/(max(x)-min(x))</span></span>
<span id="cb40-357"><a href="#cb40-357" aria-hidden="true" tabindex="-1"></a><span class="in">    }))</span></span>
<span id="cb40-358"><a href="#cb40-358" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm$x &lt;- df_i$bin[1:10]</span></span>
<span id="cb40-359"><a href="#cb40-359" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm &lt;- </span></span>
<span id="cb40-360"><a href="#cb40-360" aria-hidden="true" tabindex="-1"></a><span class="in">    df_i_norm |&gt;</span></span>
<span id="cb40-361"><a href="#cb40-361" aria-hidden="true" tabindex="-1"></a><span class="in">    pivot_longer(!x, names_to = 'Target', values_to = "Value")</span></span>
<span id="cb40-362"><a href="#cb40-362" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm$x &lt;- as.numeric(df_i_norm$x)</span></span>
<span id="cb40-363"><a href="#cb40-363" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm$Target &lt;- factor(</span></span>
<span id="cb40-364"><a href="#cb40-364" aria-hidden="true" tabindex="-1"></a><span class="in">    df_i_norm$Target, </span></span>
<span id="cb40-365"><a href="#cb40-365" aria-hidden="true" tabindex="-1"></a><span class="in">    levels = c('PTi','ITi-D','ITi-V')</span></span>
<span id="cb40-366"><a href="#cb40-366" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb40-367"><a href="#cb40-367" aria-hidden="true" tabindex="-1"></a><span class="in">  df_i_norm &lt;- df_i_norm[which(df_i_norm$Target==Proj_module[i]),]</span></span>
<span id="cb40-368"><a href="#cb40-368" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb40-369"><a href="#cb40-369" aria-hidden="true" tabindex="-1"></a><span class="in">  cor &lt;- cor.test(df_i_norm$x, df_i_norm$Value, "two.sided", "pearson")</span></span>
<span id="cb40-370"><a href="#cb40-370" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- round(cor$estimate,2)</span></span>
<span id="cb40-371"><a href="#cb40-371" aria-hidden="true" tabindex="-1"></a><span class="in">  P &lt;- format(cor$p.value, digits = 2)</span></span>
<span id="cb40-372"><a href="#cb40-372" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb40-373"><a href="#cb40-373" aria-hidden="true" tabindex="-1"></a><span class="in">  plist[[i]] &lt;- </span></span>
<span id="cb40-374"><a href="#cb40-374" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(df_i_norm, aes(x=x, y=Value, color=Target)) +</span></span>
<span id="cb40-375"><a href="#cb40-375" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(linewidth=1) +</span></span>
<span id="cb40-376"><a href="#cb40-376" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(aes(fill=Target),shape=21, color="black" , size=3) +</span></span>
<span id="cb40-377"><a href="#cb40-377" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(x=1, y=0.95, label = paste('R =',R,'\nP =',P,sep=' '), hjust=0,</span></span>
<span id="cb40-378"><a href="#cb40-378" aria-hidden="true" tabindex="-1"></a><span class="in">              color="black") +</span></span>
<span id="cb40-379"><a href="#cb40-379" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(breaks = c(1,5,10), </span></span>
<span id="cb40-380"><a href="#cb40-380" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = c("10%","50%","100%")) +</span></span>
<span id="cb40-381"><a href="#cb40-381" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_color_manual(values = col_Proj_module) +</span></span>
<span id="cb40-382"><a href="#cb40-382" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = col_Proj_module) +</span></span>
<span id="cb40-383"><a href="#cb40-383" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x=paste(Gene_module[i],"expression"), </span></span>
<span id="cb40-384"><a href="#cb40-384" aria-hidden="true" tabindex="-1"></a><span class="in">         y=paste(Proj_module[i],"projection strength"), </span></span>
<span id="cb40-385"><a href="#cb40-385" aria-hidden="true" tabindex="-1"></a><span class="in">         title=paste(Gene_module[i])) +</span></span>
<span id="cb40-386"><a href="#cb40-386" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() + </span></span>
<span id="cb40-387"><a href="#cb40-387" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position="none", plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-388"><a href="#cb40-388" aria-hidden="true" tabindex="-1"></a><span class="in">          text = element_text(size = 10))</span></span>
<span id="cb40-389"><a href="#cb40-389" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb40-390"><a href="#cb40-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-391"><a href="#cb40-391" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_D &lt;- plot_grid(plotlist = plist, nrow = 1)</span></span>
<span id="cb40-392"><a href="#cb40-392" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_D</span></span>
<span id="cb40-393"><a href="#cb40-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-394"><a href="#cb40-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-397"><a href="#cb40-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-398"><a href="#cb40-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-399"><a href="#cb40-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-400"><a href="#cb40-400" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_D.pdf"</span>, <span class="at">plot =</span> Figure6_D,</span>
<span id="cb40-401"><a href="#cb40-401" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-402"><a href="#cb40-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-403"><a href="#cb40-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-404"><a href="#cb40-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-405"><a href="#cb40-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-406"><a href="#cb40-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-407"><a href="#cb40-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-408"><a href="#cb40-408" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_E</span></span>
<span id="cb40-409"><a href="#cb40-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-412"><a href="#cb40-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-413"><a href="#cb40-413" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/csv/CAMs_AGMs/CAMs_AGMs.hdwgcna.RData"</span>)</span>
<span id="cb40-414"><a href="#cb40-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-415"><a href="#cb40-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-416"><a href="#cb40-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-417"><a href="#cb40-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=4}</span></span>
<span id="cb40-418"><a href="#cb40-418" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb40-419"><a href="#cb40-419" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb40-420"><a href="#cb40-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-421"><a href="#cb40-421" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(20240703)</span></span>
<span id="cb40-422"><a href="#cb40-422" aria-hidden="true" tabindex="-1"></a><span class="in">modules &lt;- GetModules(seu.hdwgcna.AGMs_CAMs)</span></span>
<span id="cb40-423"><a href="#cb40-423" aria-hidden="true" tabindex="-1"></a><span class="in">mods &lt;- levels(modules$module)</span></span>
<span id="cb40-424"><a href="#cb40-424" aria-hidden="true" tabindex="-1"></a><span class="in">mods &lt;- mods[mods != 'grey']</span></span>
<span id="cb40-425"><a href="#cb40-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-426"><a href="#cb40-426" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_E &lt;- </span></span>
<span id="cb40-427"><a href="#cb40-427" aria-hidden="true" tabindex="-1"></a><span class="in">  HubGeneNetworkPlot(</span></span>
<span id="cb40-428"><a href="#cb40-428" aria-hidden="true" tabindex="-1"></a><span class="in">  seu.hdwgcna.AGMs_CAMs,</span></span>
<span id="cb40-429"><a href="#cb40-429" aria-hidden="true" tabindex="-1"></a><span class="in">  n_hubs = 10, n_other=100,</span></span>
<span id="cb40-430"><a href="#cb40-430" aria-hidden="true" tabindex="-1"></a><span class="in">  edge_prop = 0.8,</span></span>
<span id="cb40-431"><a href="#cb40-431" aria-hidden="true" tabindex="-1"></a><span class="in">  edge.alpha = 0.8,</span></span>
<span id="cb40-432"><a href="#cb40-432" aria-hidden="true" tabindex="-1"></a><span class="in">  mods = mods,  </span></span>
<span id="cb40-433"><a href="#cb40-433" aria-hidden="true" tabindex="-1"></a><span class="in">  return_graph=FALSE</span></span>
<span id="cb40-434"><a href="#cb40-434" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb40-435"><a href="#cb40-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-436"><a href="#cb40-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-437"><a href="#cb40-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-438"><a href="#cb40-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-439"><a href="#cb40-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-440"><a href="#cb40-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-441"><a href="#cb40-441" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_F</span></span>
<span id="cb40-442"><a href="#cb40-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-445"><a href="#cb40-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-446"><a href="#cb40-446" aria-hidden="true" tabindex="-1"></a>Barcode_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MD-I"</span>,<span class="st">"RE-I"</span>,<span class="st">"DR-I"</span>,<span class="st">"VTA-I"</span>,<span class="st">"LHA-I"</span>,<span class="st">"SC-I"</span>, </span>
<span id="cb40-447"><a href="#cb40-447" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"VIS-I"</span>,<span class="st">"SSp-I"</span>,<span class="st">"CP-I"</span>,<span class="st">"AUD-I"</span>,<span class="st">"RSP-I"</span>,</span>
<span id="cb40-448"><a href="#cb40-448" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BLA-I"</span>,<span class="st">"ACB-I"</span>,<span class="st">"ENTl-I"</span>,<span class="st">"AId-I"</span>,<span class="st">"ECT-I"</span>,</span>
<span id="cb40-449"><a href="#cb40-449" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"ACB-C"</span>,<span class="st">"PL-C"</span>,<span class="st">"ECT-C"</span>,<span class="st">"ENTl-C"</span>,<span class="st">"BLA-C"</span>,<span class="st">"CP-C"</span>,<span class="st">"AId-C"</span>,<span class="st">"RSP-C"</span>)</span>
<span id="cb40-450"><a href="#cb40-450" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> all.Adult<span class="sc">@</span>meta.data[<span class="fu">colnames</span>(seu.hdwgcna.AGMs_CAMs), Barcode_order]</span>
<span id="cb40-451"><a href="#cb40-451" aria-hidden="true" tabindex="-1"></a>Ex_BC_mat <span class="ot">&lt;-</span> <span class="fu">log1p</span>(<span class="dv">10000</span><span class="sc">*</span>Ex_BC_mat<span class="sc">/</span>seu.hdwgcna.AGMs_CAMs<span class="sc">$</span>nCount_RNA)</span>
<span id="cb40-452"><a href="#cb40-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-453"><a href="#cb40-453" aria-hidden="true" tabindex="-1"></a><span class="co"># module ME</span></span>
<span id="cb40-454"><a href="#cb40-454" aria-hidden="true" tabindex="-1"></a>m_obj <span class="ot">&lt;-</span> <span class="fu">GetMetacellObject</span>(seu.hdwgcna.AGMs_CAMs)</span>
<span id="cb40-455"><a href="#cb40-455" aria-hidden="true" tabindex="-1"></a>MEs <span class="ot">&lt;-</span> <span class="fu">GetMEs</span>(seu.hdwgcna.AGMs_CAMs, <span class="at">harmonized=</span><span class="cn">FALSE</span>)</span>
<span id="cb40-456"><a href="#cb40-456" aria-hidden="true" tabindex="-1"></a>MEs <span class="ot">&lt;-</span> MEs[,<span class="sc">-</span><span class="fu">grep</span>(<span class="st">'grey'</span>,<span class="fu">colnames</span>(MEs))]</span>
<span id="cb40-457"><a href="#cb40-457" aria-hidden="true" tabindex="-1"></a><span class="co"># metacell module ME</span></span>
<span id="cb40-458"><a href="#cb40-458" aria-hidden="true" tabindex="-1"></a>meta_MEs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(m_obj<span class="sc">@</span>meta.data), <span class="at">ncol =</span> <span class="fu">ncol</span>(MEs))</span>
<span id="cb40-459"><a href="#cb40-459" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_MEs) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(m_obj<span class="sc">@</span>meta.data)</span>
<span id="cb40-460"><a href="#cb40-460" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_MEs) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(MEs)</span>
<span id="cb40-461"><a href="#cb40-461" aria-hidden="true" tabindex="-1"></a><span class="co"># metacell Barcode</span></span>
<span id="cb40-462"><a href="#cb40-462" aria-hidden="true" tabindex="-1"></a>meta_BCs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(m_obj<span class="sc">@</span>meta.data), <span class="at">ncol =</span> <span class="fu">length</span>(Barcode_order))</span>
<span id="cb40-463"><a href="#cb40-463" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_BCs) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(m_obj<span class="sc">@</span>meta.data)</span>
<span id="cb40-464"><a href="#cb40-464" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_BCs) <span class="ot">&lt;-</span> Barcode_order</span>
<span id="cb40-465"><a href="#cb40-465" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(meta_MEs)){</span>
<span id="cb40-466"><a href="#cb40-466" aria-hidden="true" tabindex="-1"></a>  meta_MEs[i,] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(MEs[<span class="fu">strsplit</span>(m_obj<span class="sc">$</span>cells_merged[[i]], <span class="st">','</span>)[[<span class="dv">1</span>]],], <span class="at">na.rm =</span> T)</span>
<span id="cb40-467"><a href="#cb40-467" aria-hidden="true" tabindex="-1"></a>  meta_BCs[i,] <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Ex_BC_mat[<span class="fu">strsplit</span>(m_obj<span class="sc">$</span>cells_merged[[i]], <span class="st">','</span>)[[<span class="dv">1</span>]],], <span class="at">na.rm =</span> T)</span>
<span id="cb40-468"><a href="#cb40-468" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-469"><a href="#cb40-469" aria-hidden="true" tabindex="-1"></a>meta_BCs[<span class="fu">is.nan</span>(meta_BCs)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb40-470"><a href="#cb40-470" aria-hidden="true" tabindex="-1"></a><span class="co"># coorelation between module ME and Barcode</span></span>
<span id="cb40-471"><a href="#cb40-471" aria-hidden="true" tabindex="-1"></a>meta_R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="fu">length</span>(Barcode_order))</span>
<span id="cb40-472"><a href="#cb40-472" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta_R) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"M1"</span>,<span class="st">"M2"</span>,<span class="st">"M3"</span>,<span class="st">"M4"</span>,<span class="st">"M5"</span>)</span>
<span id="cb40-473"><a href="#cb40-473" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta_R) <span class="ot">&lt;-</span> Barcode_order</span>
<span id="cb40-474"><a href="#cb40-474" aria-hidden="true" tabindex="-1"></a>meta_P <span class="ot">&lt;-</span> meta_R</span>
<span id="cb40-475"><a href="#cb40-475" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb40-476"><a href="#cb40-476" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>){</span>
<span id="cb40-477"><a href="#cb40-477" aria-hidden="true" tabindex="-1"></a>    cor <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(meta_MEs[,<span class="fu">rownames</span>(meta_R)[i]], meta_BCs[,<span class="fu">colnames</span>(meta_R)[j]],</span>
<span id="cb40-478"><a href="#cb40-478" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"two.sided"</span>, <span class="st">"pearson"</span>)</span>
<span id="cb40-479"><a href="#cb40-479" aria-hidden="true" tabindex="-1"></a>    meta_R[i,j] <span class="ot">&lt;-</span> <span class="fu">round</span>(cor<span class="sc">$</span>estimate,<span class="dv">2</span>)</span>
<span id="cb40-480"><a href="#cb40-480" aria-hidden="true" tabindex="-1"></a>    meta_P[i,j] <span class="ot">&lt;-</span> <span class="fu">format</span>(cor<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb40-481"><a href="#cb40-481" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-482"><a href="#cb40-482" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-483"><a href="#cb40-483" aria-hidden="true" tabindex="-1"></a>meta_R <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(meta_R)</span>
<span id="cb40-484"><a href="#cb40-484" aria-hidden="true" tabindex="-1"></a>meta_R<span class="sc">$</span>Module <span class="ot">&lt;-</span> <span class="fu">rownames</span>(meta_R)</span>
<span id="cb40-485"><a href="#cb40-485" aria-hidden="true" tabindex="-1"></a>df_meta_R <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(meta_R, <span class="sc">!</span>Module, <span class="at">names_to =</span> <span class="st">"Target"</span>, <span class="at">values_to =</span> <span class="st">"R"</span>)</span>
<span id="cb40-486"><a href="#cb40-486" aria-hidden="true" tabindex="-1"></a>meta_P <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(meta_P)</span>
<span id="cb40-487"><a href="#cb40-487" aria-hidden="true" tabindex="-1"></a>meta_P<span class="sc">$</span>Module <span class="ot">&lt;-</span> <span class="fu">rownames</span>(meta_P)</span>
<span id="cb40-488"><a href="#cb40-488" aria-hidden="true" tabindex="-1"></a>df_meta_P <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(meta_P, <span class="sc">!</span>Module, <span class="at">names_to =</span> <span class="st">"Target"</span>, <span class="at">values_to =</span> <span class="st">"Pvalue"</span>)</span>
<span id="cb40-489"><a href="#cb40-489" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-490"><a href="#cb40-490" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Module"</span> <span class="ot">=</span> df_meta_R<span class="sc">$</span>Module,</span>
<span id="cb40-491"><a href="#cb40-491" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Target"</span> <span class="ot">=</span> df_meta_R<span class="sc">$</span>Target,</span>
<span id="cb40-492"><a href="#cb40-492" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(df_meta_R<span class="sc">$</span>R),</span>
<span id="cb40-493"><a href="#cb40-493" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pvalue"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(df_meta_P<span class="sc">$</span>Pvalue)</span>
<span id="cb40-494"><a href="#cb40-494" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-495"><a href="#cb40-495" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Log_Pvalue <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log10</span>(df<span class="sc">$</span>Pvalue)</span>
<span id="cb40-496"><a href="#cb40-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-497"><a href="#cb40-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-498"><a href="#cb40-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-499"><a href="#cb40-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=4}</span></span>
<span id="cb40-500"><a href="#cb40-500" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb40-501"><a href="#cb40-501" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb40-502"><a href="#cb40-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-503"><a href="#cb40-503" aria-hidden="true" tabindex="-1"></a><span class="in">Barcode &lt;- c("VIS-I","SSp-I","CP-I","AUD-I","RSP-I",</span></span>
<span id="cb40-504"><a href="#cb40-504" aria-hidden="true" tabindex="-1"></a><span class="in">             "BLA-I","ACB-I","ENTl-I","AId-I","ECT-I",</span></span>
<span id="cb40-505"><a href="#cb40-505" aria-hidden="true" tabindex="-1"></a><span class="in">             "ACB-C","PL-C","ECT-C","ENTl-C","BLA-C","CP-C","AId-C","RSP-C",</span></span>
<span id="cb40-506"><a href="#cb40-506" aria-hidden="true" tabindex="-1"></a><span class="in">             "MD-I","RE-I","DR-I","VTA-I","LHA-I","SC-I")</span></span>
<span id="cb40-507"><a href="#cb40-507" aria-hidden="true" tabindex="-1"></a><span class="in">df$Target &lt;- factor(df$Target, levels = Barcode)</span></span>
<span id="cb40-508"><a href="#cb40-508" aria-hidden="true" tabindex="-1"></a><span class="in">df$Module &lt;- factor(df$Module, levels = rev(c("M1","M2","M3","M4","M5")))</span></span>
<span id="cb40-509"><a href="#cb40-509" aria-hidden="true" tabindex="-1"></a><span class="in">df$label &lt;- ""</span></span>
<span id="cb40-510"><a href="#cb40-510" aria-hidden="true" tabindex="-1"></a><span class="in">df$label[which(df$R&gt;0 &amp; df$Pvalue &lt; 0.05)] &lt;- "*"</span></span>
<span id="cb40-511"><a href="#cb40-511" aria-hidden="true" tabindex="-1"></a><span class="in">df$label[which(df$R&gt;0 &amp; df$Pvalue &lt; 0.01)] &lt;- "**"</span></span>
<span id="cb40-512"><a href="#cb40-512" aria-hidden="true" tabindex="-1"></a><span class="in">df$label[which(df$R&gt;0 &amp; df$Pvalue &lt; 0.001)] &lt;- "***"</span></span>
<span id="cb40-513"><a href="#cb40-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-514"><a href="#cb40-514" aria-hidden="true" tabindex="-1"></a><span class="in">breaks &lt;- seq(-0.5,0.5,0.01)</span></span>
<span id="cb40-515"><a href="#cb40-515" aria-hidden="true" tabindex="-1"></a><span class="in">df$R[which(df$R &lt; -0.5)] &lt;- -0.5</span></span>
<span id="cb40-516"><a href="#cb40-516" aria-hidden="true" tabindex="-1"></a><span class="in">df$R[which(df$R &gt; 0.5)] &lt;- 0.5</span></span>
<span id="cb40-517"><a href="#cb40-517" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_F &lt;- </span></span>
<span id="cb40-518"><a href="#cb40-518" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(df, aes(x=Target, y=Module, fill=R)) +</span></span>
<span id="cb40-519"><a href="#cb40-519" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile(color="gray", size=0.5) +</span></span>
<span id="cb40-520"><a href="#cb40-520" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label=label),col ="black",size = 4) +</span></span>
<span id="cb40-521"><a href="#cb40-521" aria-hidden="true" tabindex="-1"></a><span class="in">  #geom_vline(xintercept = c(1.5:23.5), size=1, color="lightgray") +</span></span>
<span id="cb40-522"><a href="#cb40-522" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(limits=c(-0.5,0.5), colours = colorRampPalette(c("navy","white","firebrick3"))(100), na.value="firebrick3") +</span></span>
<span id="cb40-523"><a href="#cb40-523" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb40-524"><a href="#cb40-524" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust = 0.5, size = 15), </span></span>
<span id="cb40-525"><a href="#cb40-525" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(size = 15),</span></span>
<span id="cb40-526"><a href="#cb40-526" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid = element_blank()) +</span></span>
<span id="cb40-527"><a href="#cb40-527" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x="", y="")</span></span>
<span id="cb40-528"><a href="#cb40-528" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_F</span></span>
<span id="cb40-529"><a href="#cb40-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-530"><a href="#cb40-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-531"><a href="#cb40-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-534"><a href="#cb40-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-535"><a href="#cb40-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-536"><a href="#cb40-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-537"><a href="#cb40-537" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_F.pdf"</span>, <span class="at">plot =</span> Figure6_F,</span>
<span id="cb40-538"><a href="#cb40-538" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-539"><a href="#cb40-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-540"><a href="#cb40-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-541"><a href="#cb40-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-542"><a href="#cb40-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-543"><a href="#cb40-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-544"><a href="#cb40-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-545"><a href="#cb40-545" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_G</span></span>
<span id="cb40-546"><a href="#cb40-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-549"><a href="#cb40-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-550"><a href="#cb40-550" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> seu.hdwgcna.AGMs_CAMs</span>
<span id="cb40-551"><a href="#cb40-551" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings)</span>
<span id="cb40-552"><a href="#cb40-552" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M2 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M2</span>
<span id="cb40-553"><a href="#cb40-553" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M4 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M4</span>
<span id="cb40-554"><a href="#cb40-554" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span></span>
<span id="cb40-555"><a href="#cb40-555" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-556"><a href="#cb40-556" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span></span>
<span id="cb40-557"><a href="#cb40-557" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-558"><a href="#cb40-558" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">which</span>(seu<span class="sc">$</span>Ex_subtype<span class="sc">==</span><span class="st">"IT"</span>),]</span>
<span id="cb40-559"><a href="#cb40-559" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>UMAP_1 <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> df<span class="sc">$</span>UMAP_2 <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">3</span>,]</span>
<span id="cb40-560"><a href="#cb40-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-561"><a href="#cb40-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-562"><a href="#cb40-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-563"><a href="#cb40-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=3}</span></span>
<span id="cb40-564"><a href="#cb40-564" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_1 &lt;- </span></span>
<span id="cb40-565"><a href="#cb40-565" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb40-566"><a href="#cb40-566" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(df, mapping = aes(x = UMAP_1, y = UMAP_2), color="lightgray", size=1) +</span></span>
<span id="cb40-567"><a href="#cb40-567" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointdensity(df[which(df$M4&gt;0),], mapping = aes(x = UMAP_1, y = UMAP_2), size=1) +</span></span>
<span id="cb40-568"><a href="#cb40-568" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_gradientn(colours = c("lightgray","white","blue"),</span></span>
<span id="cb40-569"><a href="#cb40-569" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.value = "blue",</span></span>
<span id="cb40-570"><a href="#cb40-570" aria-hidden="true" tabindex="-1"></a><span class="in">                        limits = c(0,50),</span></span>
<span id="cb40-571"><a href="#cb40-571" aria-hidden="true" tabindex="-1"></a><span class="in">                        breaks = c(0,50)</span></span>
<span id="cb40-572"><a href="#cb40-572" aria-hidden="true" tabindex="-1"></a><span class="in">                        ) +</span></span>
<span id="cb40-573"><a href="#cb40-573" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb40-574"><a href="#cb40-574" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb40-575"><a href="#cb40-575" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "M4", x="", y="", colour = "") +</span></span>
<span id="cb40-576"><a href="#cb40-576" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-577"><a href="#cb40-577" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks = element_blank(), axis.text = element_blank(),</span></span>
<span id="cb40-578"><a href="#cb40-578" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid = element_blank(),</span></span>
<span id="cb40-579"><a href="#cb40-579" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "right",</span></span>
<span id="cb40-580"><a href="#cb40-580" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.width  = unit(0.5, "lines"),</span></span>
<span id="cb40-581"><a href="#cb40-581" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.height = unit(2, "lines"))</span></span>
<span id="cb40-582"><a href="#cb40-582" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_1</span></span>
<span id="cb40-583"><a href="#cb40-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-584"><a href="#cb40-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-585"><a href="#cb40-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-588"><a href="#cb40-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-589"><a href="#cb40-589" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-590"><a href="#cb40-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-591"><a href="#cb40-591" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_1.pdf"</span>, <span class="at">plot =</span> Figure6_G_1,</span>
<span id="cb40-592"><a href="#cb40-592" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-593"><a href="#cb40-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-594"><a href="#cb40-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-595"><a href="#cb40-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-596"><a href="#cb40-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=3}</span></span>
<span id="cb40-597"><a href="#cb40-597" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_2 &lt;- </span></span>
<span id="cb40-598"><a href="#cb40-598" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb40-599"><a href="#cb40-599" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(df, mapping = aes(x = UMAP_1, y = UMAP_2), color="lightgray", size=1) +</span></span>
<span id="cb40-600"><a href="#cb40-600" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointdensity(df[which(df$`CP-C`&gt;0),], mapping = aes(x = UMAP_1, y = UMAP_2), size=1) +</span></span>
<span id="cb40-601"><a href="#cb40-601" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_gradientn(colours = c("lightgray","white","red"),</span></span>
<span id="cb40-602"><a href="#cb40-602" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.value = "red",</span></span>
<span id="cb40-603"><a href="#cb40-603" aria-hidden="true" tabindex="-1"></a><span class="in">                        limits = c(0,50),</span></span>
<span id="cb40-604"><a href="#cb40-604" aria-hidden="true" tabindex="-1"></a><span class="in">                        breaks = c(0,50)</span></span>
<span id="cb40-605"><a href="#cb40-605" aria-hidden="true" tabindex="-1"></a><span class="in">                        ) +</span></span>
<span id="cb40-606"><a href="#cb40-606" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb40-607"><a href="#cb40-607" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb40-608"><a href="#cb40-608" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "CP-C", x="", y="", colour = "") +</span></span>
<span id="cb40-609"><a href="#cb40-609" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-610"><a href="#cb40-610" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks = element_blank(), axis.text = element_blank(),</span></span>
<span id="cb40-611"><a href="#cb40-611" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid = element_blank(),</span></span>
<span id="cb40-612"><a href="#cb40-612" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "right",</span></span>
<span id="cb40-613"><a href="#cb40-613" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.width  = unit(0.5, "lines"),</span></span>
<span id="cb40-614"><a href="#cb40-614" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.height = unit(2, "lines"))</span></span>
<span id="cb40-615"><a href="#cb40-615" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_2</span></span>
<span id="cb40-616"><a href="#cb40-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-617"><a href="#cb40-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-618"><a href="#cb40-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-621"><a href="#cb40-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-622"><a href="#cb40-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-623"><a href="#cb40-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-624"><a href="#cb40-624" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_2.pdf"</span>, <span class="at">plot =</span> Figure6_G_2,</span>
<span id="cb40-625"><a href="#cb40-625" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-626"><a href="#cb40-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-627"><a href="#cb40-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-628"><a href="#cb40-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-629"><a href="#cb40-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=4}</span></span>
<span id="cb40-630"><a href="#cb40-630" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor &lt;- df[which(df$`CP-C`&gt;0),]</span></span>
<span id="cb40-631"><a href="#cb40-631" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor[,'exp_order'] &lt;- rank(df_cor$M4)</span></span>
<span id="cb40-632"><a href="#cb40-632" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor[,'bin'] &lt;- cut(</span></span>
<span id="cb40-633"><a href="#cb40-633" aria-hidden="true" tabindex="-1"></a><span class="in">  df_cor[,'exp_order'],</span></span>
<span id="cb40-634"><a href="#cb40-634" aria-hidden="true" tabindex="-1"></a><span class="in">  seq(1, max(df_cor[,'exp_order']), length.out=11),</span></span>
<span id="cb40-635"><a href="#cb40-635" aria-hidden="true" tabindex="-1"></a><span class="in">  labels = c(1:10)</span></span>
<span id="cb40-636"><a href="#cb40-636" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb40-637"><a href="#cb40-637" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor &lt;- </span></span>
<span id="cb40-638"><a href="#cb40-638" aria-hidden="true" tabindex="-1"></a><span class="in">  df_cor |&gt;</span></span>
<span id="cb40-639"><a href="#cb40-639" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(bin) |&gt;</span></span>
<span id="cb40-640"><a href="#cb40-640" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::summarize(across(3:6, ~ mean(.x, na.rm = TRUE)))</span></span>
<span id="cb40-641"><a href="#cb40-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-642"><a href="#cb40-642" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor_norm &lt;- as.data.frame(apply(df_cor[1:10,2:ncol(df_cor)],2,function(x){</span></span>
<span id="cb40-643"><a href="#cb40-643" aria-hidden="true" tabindex="-1"></a><span class="in">    (x-min(x))/(max(x)-min(x))</span></span>
<span id="cb40-644"><a href="#cb40-644" aria-hidden="true" tabindex="-1"></a><span class="in">    }))</span></span>
<span id="cb40-645"><a href="#cb40-645" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor_norm$x &lt;- df_cor$bin[1:10]</span></span>
<span id="cb40-646"><a href="#cb40-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-647"><a href="#cb40-647" aria-hidden="true" tabindex="-1"></a><span class="in">cor &lt;- cor.test(df_cor_norm$M4, df_cor_norm$`CP-C`, "two.sided", "pearson")</span></span>
<span id="cb40-648"><a href="#cb40-648" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- round(cor$estimate,2)</span></span>
<span id="cb40-649"><a href="#cb40-649" aria-hidden="true" tabindex="-1"></a><span class="in">P &lt;- format(cor$p.value, digits = 2)</span></span>
<span id="cb40-650"><a href="#cb40-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-651"><a href="#cb40-651" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_3 &lt;- </span></span>
<span id="cb40-652"><a href="#cb40-652" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(df_cor_norm, aes(x=x, y=`CP-C`, group=1)) +</span></span>
<span id="cb40-653"><a href="#cb40-653" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(linewidth=1, color="blue") +</span></span>
<span id="cb40-654"><a href="#cb40-654" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(fill="blue",shape=21, color="black" , size=3) +</span></span>
<span id="cb40-655"><a href="#cb40-655" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(x=1, y=0.95, label = paste('R =',R,'\nP =',P,sep=' '), hjust=0,</span></span>
<span id="cb40-656"><a href="#cb40-656" aria-hidden="true" tabindex="-1"></a><span class="in">              color="black") +</span></span>
<span id="cb40-657"><a href="#cb40-657" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(breaks = c(1,5,10), </span></span>
<span id="cb40-658"><a href="#cb40-658" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("10%","50%","100%")) +</span></span>
<span id="cb40-659"><a href="#cb40-659" aria-hidden="true" tabindex="-1"></a><span class="in">    #scale_color_manual(values = col_Proj_module) +</span></span>
<span id="cb40-660"><a href="#cb40-660" aria-hidden="true" tabindex="-1"></a><span class="in">    #scale_fill_manual(values = col_Proj_module) +</span></span>
<span id="cb40-661"><a href="#cb40-661" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x=paste("M4 Eigengenes"), </span></span>
<span id="cb40-662"><a href="#cb40-662" aria-hidden="true" tabindex="-1"></a><span class="in">         y=paste("CP-C projection strength"), </span></span>
<span id="cb40-663"><a href="#cb40-663" aria-hidden="true" tabindex="-1"></a><span class="in">         title="") +</span></span>
<span id="cb40-664"><a href="#cb40-664" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() + </span></span>
<span id="cb40-665"><a href="#cb40-665" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position="none", plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-666"><a href="#cb40-666" aria-hidden="true" tabindex="-1"></a><span class="in">          text = element_text(size = 10))</span></span>
<span id="cb40-667"><a href="#cb40-667" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_G_3</span></span>
<span id="cb40-668"><a href="#cb40-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-669"><a href="#cb40-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-670"><a href="#cb40-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-673"><a href="#cb40-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-674"><a href="#cb40-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-675"><a href="#cb40-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-676"><a href="#cb40-676" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_G_3.pdf"</span>, <span class="at">plot =</span> Figure6_G_3,</span>
<span id="cb40-677"><a href="#cb40-677" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-678"><a href="#cb40-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-679"><a href="#cb40-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-680"><a href="#cb40-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-681"><a href="#cb40-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-682"><a href="#cb40-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-683"><a href="#cb40-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-684"><a href="#cb40-684" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure6_H</span></span>
<span id="cb40-685"><a href="#cb40-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-688"><a href="#cb40-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-689"><a href="#cb40-689" aria-hidden="true" tabindex="-1"></a>seu <span class="ot">&lt;-</span> seu.hdwgcna.AGMs_CAMs</span>
<span id="cb40-690"><a href="#cb40-690" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seu<span class="sc">@</span>reductions<span class="sc">$</span>umap<span class="sc">@</span>cell.embeddings)</span>
<span id="cb40-691"><a href="#cb40-691" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M2 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M2</span>
<span id="cb40-692"><a href="#cb40-692" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>M4 <span class="ot">&lt;-</span> seu<span class="sc">@</span>misc<span class="sc">$</span>AGMs_CAMs<span class="sc">$</span>MEs<span class="sc">$</span>M4</span>
<span id="cb40-693"><a href="#cb40-693" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span></span>
<span id="cb40-694"><a href="#cb40-694" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">AId-I</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-695"><a href="#cb40-695" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span> <span class="ot">&lt;-</span> seu<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span></span>
<span id="cb40-696"><a href="#cb40-696" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>[<span class="fu">is.na</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">CP-C</span><span class="st">`</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-697"><a href="#cb40-697" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">which</span>(seu<span class="sc">$</span>Ex_subtype<span class="sc">==</span><span class="st">"IT"</span>),]</span>
<span id="cb40-698"><a href="#cb40-698" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>UMAP_1 <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> df<span class="sc">$</span>UMAP_2 <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">3</span>,]</span>
<span id="cb40-699"><a href="#cb40-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-700"><a href="#cb40-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-701"><a href="#cb40-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=3}</span></span>
<span id="cb40-702"><a href="#cb40-702" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_1 &lt;- </span></span>
<span id="cb40-703"><a href="#cb40-703" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb40-704"><a href="#cb40-704" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(df, mapping = aes(x = UMAP_1, y = UMAP_2), color="lightgray", size=1) +</span></span>
<span id="cb40-705"><a href="#cb40-705" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointdensity(df[which(df$M2&gt;0),], mapping = aes(x = UMAP_1, y = UMAP_2), size=1) +</span></span>
<span id="cb40-706"><a href="#cb40-706" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_gradientn(colours = c("lightgray","white","yellow"),</span></span>
<span id="cb40-707"><a href="#cb40-707" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.value = "yellow",</span></span>
<span id="cb40-708"><a href="#cb40-708" aria-hidden="true" tabindex="-1"></a><span class="in">                        limits = c(0,50),</span></span>
<span id="cb40-709"><a href="#cb40-709" aria-hidden="true" tabindex="-1"></a><span class="in">                        breaks = c(0,50)</span></span>
<span id="cb40-710"><a href="#cb40-710" aria-hidden="true" tabindex="-1"></a><span class="in">                        ) +</span></span>
<span id="cb40-711"><a href="#cb40-711" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb40-712"><a href="#cb40-712" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb40-713"><a href="#cb40-713" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "M2", x="", y="", colour = "") +</span></span>
<span id="cb40-714"><a href="#cb40-714" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-715"><a href="#cb40-715" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks = element_blank(), axis.text = element_blank(),</span></span>
<span id="cb40-716"><a href="#cb40-716" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid = element_blank(),</span></span>
<span id="cb40-717"><a href="#cb40-717" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "right",</span></span>
<span id="cb40-718"><a href="#cb40-718" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.width  = unit(0.5, "lines"),</span></span>
<span id="cb40-719"><a href="#cb40-719" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.height = unit(2, "lines"))</span></span>
<span id="cb40-720"><a href="#cb40-720" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_1</span></span>
<span id="cb40-721"><a href="#cb40-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-722"><a href="#cb40-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-723"><a href="#cb40-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-726"><a href="#cb40-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-727"><a href="#cb40-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-728"><a href="#cb40-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-729"><a href="#cb40-729" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_1.pdf"</span>, <span class="at">plot =</span> Figure6_H_1,</span>
<span id="cb40-730"><a href="#cb40-730" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-731"><a href="#cb40-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-732"><a href="#cb40-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-733"><a href="#cb40-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-734"><a href="#cb40-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=3}</span></span>
<span id="cb40-735"><a href="#cb40-735" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_2 &lt;- </span></span>
<span id="cb40-736"><a href="#cb40-736" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb40-737"><a href="#cb40-737" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(df, mapping = aes(x = UMAP_1, y = UMAP_2), color="lightgray", size=1) +</span></span>
<span id="cb40-738"><a href="#cb40-738" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointdensity(df[which(df$`AId-I`&gt;0),], mapping = aes(x = UMAP_1, y = UMAP_2), size=1) +</span></span>
<span id="cb40-739"><a href="#cb40-739" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_gradientn(colours = c("lightgray","white","red"),</span></span>
<span id="cb40-740"><a href="#cb40-740" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.value = "red",</span></span>
<span id="cb40-741"><a href="#cb40-741" aria-hidden="true" tabindex="-1"></a><span class="in">                        limits = c(0,50),</span></span>
<span id="cb40-742"><a href="#cb40-742" aria-hidden="true" tabindex="-1"></a><span class="in">                        breaks = c(0,50)</span></span>
<span id="cb40-743"><a href="#cb40-743" aria-hidden="true" tabindex="-1"></a><span class="in">                        ) +</span></span>
<span id="cb40-744"><a href="#cb40-744" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb40-745"><a href="#cb40-745" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb40-746"><a href="#cb40-746" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "AId-I", x="", y="", colour = "") +</span></span>
<span id="cb40-747"><a href="#cb40-747" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-748"><a href="#cb40-748" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks = element_blank(), axis.text = element_blank(),</span></span>
<span id="cb40-749"><a href="#cb40-749" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid = element_blank(),</span></span>
<span id="cb40-750"><a href="#cb40-750" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "right",</span></span>
<span id="cb40-751"><a href="#cb40-751" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.width  = unit(0.5, "lines"),</span></span>
<span id="cb40-752"><a href="#cb40-752" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.height = unit(2, "lines"))</span></span>
<span id="cb40-753"><a href="#cb40-753" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_2</span></span>
<span id="cb40-754"><a href="#cb40-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-755"><a href="#cb40-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-756"><a href="#cb40-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-759"><a href="#cb40-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-760"><a href="#cb40-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-761"><a href="#cb40-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-762"><a href="#cb40-762" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_2.pdf"</span>, <span class="at">plot =</span> Figure6_H_2,</span>
<span id="cb40-763"><a href="#cb40-763" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-764"><a href="#cb40-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-765"><a href="#cb40-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-766"><a href="#cb40-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-767"><a href="#cb40-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=4}</span></span>
<span id="cb40-768"><a href="#cb40-768" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor &lt;- df[which(df$`AId-I`&gt;0),]</span></span>
<span id="cb40-769"><a href="#cb40-769" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor[,'exp_order'] &lt;- rank(df_cor$M2)</span></span>
<span id="cb40-770"><a href="#cb40-770" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor[,'bin'] &lt;- cut(</span></span>
<span id="cb40-771"><a href="#cb40-771" aria-hidden="true" tabindex="-1"></a><span class="in">  df_cor[,'exp_order'],</span></span>
<span id="cb40-772"><a href="#cb40-772" aria-hidden="true" tabindex="-1"></a><span class="in">  seq(1, max(df_cor[,'exp_order']), length.out=11),</span></span>
<span id="cb40-773"><a href="#cb40-773" aria-hidden="true" tabindex="-1"></a><span class="in">  labels = c(1:10)</span></span>
<span id="cb40-774"><a href="#cb40-774" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb40-775"><a href="#cb40-775" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor &lt;- </span></span>
<span id="cb40-776"><a href="#cb40-776" aria-hidden="true" tabindex="-1"></a><span class="in">  df_cor |&gt;</span></span>
<span id="cb40-777"><a href="#cb40-777" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(bin) |&gt;</span></span>
<span id="cb40-778"><a href="#cb40-778" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::summarize(across(3:6, ~ mean(.x, na.rm = TRUE)))</span></span>
<span id="cb40-779"><a href="#cb40-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-780"><a href="#cb40-780" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor_norm &lt;- as.data.frame(apply(df_cor[1:10,2:ncol(df_cor)],2,function(x){</span></span>
<span id="cb40-781"><a href="#cb40-781" aria-hidden="true" tabindex="-1"></a><span class="in">    (x-min(x))/(max(x)-min(x))</span></span>
<span id="cb40-782"><a href="#cb40-782" aria-hidden="true" tabindex="-1"></a><span class="in">    }))</span></span>
<span id="cb40-783"><a href="#cb40-783" aria-hidden="true" tabindex="-1"></a><span class="in">df_cor_norm$x &lt;- df_cor$bin[1:10]</span></span>
<span id="cb40-784"><a href="#cb40-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-785"><a href="#cb40-785" aria-hidden="true" tabindex="-1"></a><span class="in">cor &lt;- cor.test(df_cor_norm$M2, df_cor_norm$`AId-I`, "two.sided", "pearson")</span></span>
<span id="cb40-786"><a href="#cb40-786" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- round(cor$estimate,2)</span></span>
<span id="cb40-787"><a href="#cb40-787" aria-hidden="true" tabindex="-1"></a><span class="in">P &lt;- format(cor$p.value, digits = 2)</span></span>
<span id="cb40-788"><a href="#cb40-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-789"><a href="#cb40-789" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_3 &lt;- </span></span>
<span id="cb40-790"><a href="#cb40-790" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(df_cor_norm, aes(x=x, y=`AId-I`, group=1)) +</span></span>
<span id="cb40-791"><a href="#cb40-791" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(linewidth=1, color="yellow") +</span></span>
<span id="cb40-792"><a href="#cb40-792" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(fill="yellow",shape=21, color="black" , size=3) +</span></span>
<span id="cb40-793"><a href="#cb40-793" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(x=1, y=0.95, label = paste('R =',R,'\nP =',P,sep=' '), hjust=0,</span></span>
<span id="cb40-794"><a href="#cb40-794" aria-hidden="true" tabindex="-1"></a><span class="in">              color="black") +</span></span>
<span id="cb40-795"><a href="#cb40-795" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(breaks = c(1,5,10), </span></span>
<span id="cb40-796"><a href="#cb40-796" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("10%","50%","100%")) +</span></span>
<span id="cb40-797"><a href="#cb40-797" aria-hidden="true" tabindex="-1"></a><span class="in">    #scale_color_manual(values = col_Proj_module) +</span></span>
<span id="cb40-798"><a href="#cb40-798" aria-hidden="true" tabindex="-1"></a><span class="in">    #scale_fill_manual(values = col_Proj_module) +</span></span>
<span id="cb40-799"><a href="#cb40-799" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x=paste("M2 Eigengenes"), </span></span>
<span id="cb40-800"><a href="#cb40-800" aria-hidden="true" tabindex="-1"></a><span class="in">         y=paste("AId-I projection strength"), </span></span>
<span id="cb40-801"><a href="#cb40-801" aria-hidden="true" tabindex="-1"></a><span class="in">         title="") +</span></span>
<span id="cb40-802"><a href="#cb40-802" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() + </span></span>
<span id="cb40-803"><a href="#cb40-803" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position="none", plot.title = element_text(hjust = 0.5, size = 20),</span></span>
<span id="cb40-804"><a href="#cb40-804" aria-hidden="true" tabindex="-1"></a><span class="in">          text = element_text(size = 10))</span></span>
<span id="cb40-805"><a href="#cb40-805" aria-hidden="true" tabindex="-1"></a><span class="in">Figure6_H_3</span></span>
<span id="cb40-806"><a href="#cb40-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-807"><a href="#cb40-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-808"><a href="#cb40-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-811"><a href="#cb40-811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb40-812"><a href="#cb40-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb40-813"><a href="#cb40-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-814"><a href="#cb40-814" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../pdf/Figure6/Figure6_H_3.pdf"</span>, <span class="at">plot =</span> Figure6_H_3,</span>
<span id="cb40-815"><a href="#cb40-815" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb40-816"><a href="#cb40-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb40-817"><a href="#cb40-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-818"><a href="#cb40-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-819"><a href="#cb40-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-820"><a href="#cb40-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-821"><a href="#cb40-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-822"><a href="#cb40-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-823"><a href="#cb40-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-824"><a href="#cb40-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-825"><a href="#cb40-825" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>